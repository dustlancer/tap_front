import{u as T}from"./A34OYPRF.js";import{_ as $,r as s,l as d,q as z,A as j,o as _,c as g,a as e,B as x,t as m,v as w,y as F,k as N,b as U}from"./WBLKiZ4P.js";const V=window.setInterval,E={class:"flex flex-col absolute top-0 w-screen z-10 items-center justify-center h-screen bg-gradient-to-b from-blue-500 to-gray-700"},q=["src"],A={class:"w-full text-center flex-col align-center absolute bottom-[15%] px-7"},R={class:"flex items-center text-4xl font-bold text-white mb-1"},G={class:"text-lg"},H={class:"h-4 bg-gray-300 rounded-full"},J={__name:"MiningCharacter",setup(k){const c=N(),a=T(),t=s(0),n=s(a.storage_capacity),v=s(5),f=s("/ermak_bomzh-removebg-preview.png"),p=s("dirty_city_bg.png"),u=s(new Date);let b=0,h=!1,l;function I(){u.value=new Date,a.claimCoins(t.value),t.value=0,clearInterval(l),y()}function B(){const r=(new Date-u.value)/(1e3*60*60),i=Math.min(r*v.value,n.value);t.value=i,b=d(()=>t.value/n.value*100),h=d(()=>t.value>=n.value),i>=n.value&&clearInterval(l)}function y(){l=V(()=>{B()},1e3)}function C(){f.value=c.public.apiBase+a.level.character_image_url,p.value=c.public.apiBase+a.level.background_image_url}const D=d(()=>({backgroundImage:`url(${p.value})`,backgroundSize:"cover",backgroundPosition:"center",filter:"grayscale(100%) contrast(400%)",mixBlendMode:"screen",opacity:.7,width:"100%",height:"100%"}));async function S(){try{const o=await fetch(`${c.public.apiBase}/api/user-storage/?user_id=${a.user_id}`);if(!o.ok)throw new Error("Ошибка загрузки данных пользователя");const r=await o.json(),{storage_capacity:i,mining_speed:M,last_claim_time:P}=r;n.value=i,v.value=M,u.value=new Date(P),y()}catch(o){console.error("Ошибка при загрузке данных: ",o)}}return z(()=>{C(),setTimeout(()=>{S()},0)}),j(()=>{l&&clearInterval(l)}),(o,r)=>(_(),g("div",E,[e("div",{style:x(D.value)},null,4),e("img",{src:f.value,alt:"Персонаж",class:"w-48 h-48 object-contain transition-transform duration-300 absolute"},null,8,q),e("div",A,[e("div",R,[e("div",null,[e("p",G,m(t.value.toFixed(2))+" / "+m(n.value.toFixed(2)),1)])]),e("div",H,[e("div",{class:"h-full bg-green-500 rounded-full transition-all duration-500",style:x({width:w(b)+"%"})},null,4)])]),w(h)?(_(),g("button",{key:0,onClick:I,class:"absolute bottom-[23%] bg-yellow-400 text-black font-bold py-2 px-4 rounded"}," Забрать "+m(t.value.toFixed(2))+" монет ",1)):F("",!0)]))}},K=$(J,[["__scopeId","data-v-4d3271cf"]]),L={class:"bg-gray-20 overflow-hidden"},W={__name:"index",setup(k){return(c,a)=>(_(),g("div",L,[U(K)]))}};export{W as default};
