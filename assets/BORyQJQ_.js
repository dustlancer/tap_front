import{h as bn,e as Vn,j as Yt,p as er,f as jn,g as tr,i as wn,u as Ln,k as Wn,l as Me,m as nr,n as rr,r as zt,q as Mn,o as xt,c as vt,s as ir,v as Gt,x as or,b as sr,a as Qe,t as ar}from"./By5D2cNy.js";async function fr(i,e){return await cr(e).catch(f=>(console.error("Failed to get image meta for "+e,f+""),{width:0,height:0,ratio:0}))}async function cr(i){if(typeof Image>"u")throw new TypeError("Image not supported");return new Promise((e,n)=>{const f=new Image;f.onload=()=>{const c={width:f.width,height:f.height,ratio:f.width/f.height};e(c)},f.onerror=c=>n(c),f.src=i})}function mn(i){return e=>e?i[e]||e:i.missingValue}function lr({formatter:i,keyMap:e,joinWith:n="/",valueMap:f}={}){i||(i=(u,g)=>`${u}=${g}`),e&&typeof e!="function"&&(e=mn(e));const c=f||{};return Object.keys(c).forEach(u=>{typeof c[u]!="function"&&(c[u]=mn(c[u]))}),(u={})=>Object.entries(u).filter(([p,L])=>typeof L<"u").map(([p,L])=>{const A=c[p];return typeof A=="function"&&(L=A(u[p])),p=typeof e=="function"?e(p):p,i(p,L)}).join(n)}function Ce(i=""){if(typeof i=="number")return i;if(typeof i=="string"&&i.replace("px","").match(/^\d+$/g))return Number.parseInt(i,10)}function dr(i=""){if(i===void 0||!i.length)return[];const e=new Set;for(const n of i.split(" ")){const f=Number.parseInt(n.replace("x",""));f&&e.add(f)}return Array.from(e)}function ur(i){if(i.length===0)throw new Error("`densities` must not be empty, configure to `1` to render regular size only (DPR 1.0)")}function hr(i){const e={};if(typeof i=="string")for(const n of i.split(/[\s,]+/).filter(f=>f)){const f=n.split(":");f.length!==2?e["1px"]=f[0].trim():e[f[0].trim()]=f[1].trim()}else Object.assign(e,i);return e}function gr(i){const e={options:i},n=(c,u={})=>In(e,c,u),f=(c,u={},g={})=>n(c,{...g,modifiers:jn(u,g.modifiers||{})}).url;for(const c in i.presets)f[c]=(u,g,p)=>f(u,g,{...i.presets[c],...p});return f.options=i,f.getImage=n,f.getMeta=(c,u)=>xr(e,c,u),f.getSizes=(c,u)=>yr(e,c,u),e.$img=f,f}async function xr(i,e,n){const f=In(i,e,{...n});return typeof f.getMeta=="function"?await f.getMeta():await fr(i,f.url)}function In(i,e,n){var A,O;if(e&&typeof e!="string")throw new TypeError(`input must be a string (received ${typeof e}: ${JSON.stringify(e)})`);if(!e||e.startsWith("data:"))return{url:e};const{provider:f,defaults:c}=vr(i,n.provider||i.options.provider),u=pr(i,n.preset);if(e=bn(e)?e:Vn(e),!f.supportsAlias){for(const Y in i.options.alias)if(e.startsWith(Y)){const se=i.options.alias[Y];se&&(e=Yt(se,e.slice(Y.length)))}}if(f.validateDomains&&bn(e)){const Y=er(e).host;if(!i.options.domains.find(se=>se===Y))return{url:e}}const g=jn(n,u,c);g.modifiers={...g.modifiers};const p=g.modifiers.format;(A=g.modifiers)!=null&&A.width&&(g.modifiers.width=Ce(g.modifiers.width)),(O=g.modifiers)!=null&&O.height&&(g.modifiers.height=Ce(g.modifiers.height));const L=f.getImage(e,g,i);return L.format=L.format||p||"",L}function vr(i,e){const n=i.options.providers[e];if(!n)throw new Error("Unknown provider: "+e);return n}function pr(i,e){if(!e)return{};if(!i.options.presets[e])throw new Error("Unknown preset: "+e);return i.options.presets[e]}function yr(i,e,n){var he,Ae,Be,ie,_e;const f=Ce((he=n.modifiers)==null?void 0:he.width),c=Ce((Ae=n.modifiers)==null?void 0:Ae.height),u=hr(n.sizes),g=(Be=n.densities)!=null&&Be.trim()?dr(n.densities.trim()):i.options.densities;ur(g);const p=f&&c?c/f:0,L=[],A=[];if(Object.keys(u).length>=1){for(const be in u){const pe=_n(be,String(u[be]),c,p,i);if(pe!==void 0){L.push({size:pe.size,screenMaxWidth:pe.screenMaxWidth,media:`(max-width: ${pe.screenMaxWidth}px)`});for(const Ee of g)A.push({width:pe._cWidth*Ee,src:Sn(i,e,n,pe,Ee)})}}br(L)}else for(const be of g){const pe=Object.keys(u)[0];let Ee=pe?_n(pe,String(u[pe]),c,p,i):void 0;Ee===void 0&&(Ee={size:"",screenMaxWidth:0,_cWidth:(ie=n.modifiers)==null?void 0:ie.width,_cHeight:(_e=n.modifiers)==null?void 0:_e.height}),A.push({width:be,src:Sn(i,e,n,Ee,be)})}wr(A);const O=A[A.length-1],Y=L.length?L.map(be=>`${be.media?be.media+" ":""}${be.size}`).join(", "):void 0,se=Y?"w":"x",ye=A.map(be=>`${be.src} ${be.width}${se}`).join(", ");return{sizes:Y,srcset:ye,src:O==null?void 0:O.src}}function _n(i,e,n,f,c){const u=c.options.screens&&c.options.screens[i]||Number.parseInt(i),g=e.endsWith("vw");if(!g&&/^\d+$/.test(e)&&(e=e+"px"),!g&&!e.endsWith("px"))return;let p=Number.parseInt(e);if(!u||!p)return;g&&(p=Math.round(p/100*u));const L=f?Math.round(p*f):n;return{size:e,screenMaxWidth:u,_cWidth:p,_cHeight:L}}function Sn(i,e,n,f,c){return i.$img(e,{...n.modifiers,width:f._cWidth?f._cWidth*c:void 0,height:f._cHeight?f._cHeight*c:void 0},n)}function br(i){var n;i.sort((f,c)=>f.screenMaxWidth-c.screenMaxWidth);let e=null;for(let f=i.length-1;f>=0;f--){const c=i[f];c.media===e&&i.splice(f,1),e=c.media}for(let f=0;f<i.length;f++)i[f].media=((n=i[f+1])==null?void 0:n.media)||""}function wr(i){i.sort((n,f)=>n.width-f.width);let e=null;for(let n=i.length-1;n>=0;n--){const f=i[n];f.width===e&&i.splice(n,1),e=f.width}}const mr=lr({keyMap:{format:"f",fit:"fit",width:"w",height:"h",resize:"s",quality:"q",background:"b"},joinWith:"&",formatter:(i,e)=>wn(i)+"_"+wn(e)}),_r=(i,{modifiers:e={},baseURL:n}={},f)=>{e.width&&e.height&&(e.resize=`${e.width}x${e.height}`,delete e.width,delete e.height);const c=mr(e)||"_";return n||(n=Yt(f.options.nuxt.baseURL,"/_ipx")),{url:Yt(n,c,tr(i))}},Sr=!0,Er=!0,Ur=Object.freeze(Object.defineProperty({__proto__:null,getImage:_r,supportsAlias:Er,validateDomains:Sr},Symbol.toStringTag,{value:"Module"})),Bn={screens:{xs:320,sm:640,md:768,lg:1024,xl:1280,xxl:1536,"2xl":1536},presets:{},provider:"ipxStatic",domains:[],alias:{},densities:[1,2],format:["webp"]};Bn.providers={ipxStatic:{provider:Ur,defaults:{}}};const kn=()=>{const i=Wn(),e=Ln();return e.$img||e._img||(e._img=gr({...Bn,nuxt:{baseURL:i.app.baseURL},runtimeConfig:i}))};function Tr(i){var e;(e=performance==null?void 0:performance.mark)==null||e.call(performance,"mark_feature_usage",{detail:{feature:i}})}const Rr={src:{type:String,required:!1},format:{type:String,required:!1},quality:{type:[Number,String],required:!1},background:{type:String,required:!1},fit:{type:String,required:!1},modifiers:{type:Object,required:!1},preset:{type:String,required:!1},provider:{type:String,required:!1},sizes:{type:[Object,String],required:!1},densities:{type:String,required:!1},preload:{type:[Boolean,Object],required:!1},width:{type:[String,Number],required:!1},height:{type:[String,Number],required:!1},alt:{type:String,required:!1},referrerpolicy:{type:String,required:!1},usemap:{type:String,required:!1},longdesc:{type:String,required:!1},ismap:{type:Boolean,required:!1},loading:{type:String,required:!1,validator:i=>["lazy","eager"].includes(i)},crossorigin:{type:[Boolean,String],required:!1,validator:i=>["anonymous","use-credentials","",!0,!1].includes(i)},decoding:{type:String,required:!1,validator:i=>["async","auto","sync"].includes(i)},nonce:{type:[String],required:!1}},Cr=i=>{const e=Me(()=>({provider:i.provider,preset:i.preset})),n=Me(()=>({width:Ce(i.width),height:Ce(i.height),alt:i.alt,referrerpolicy:i.referrerpolicy,usemap:i.usemap,longdesc:i.longdesc,ismap:i.ismap,crossorigin:i.crossorigin===!0?"anonymous":i.crossorigin||void 0,loading:i.loading,decoding:i.decoding,nonce:i.nonce})),f=kn(),c=Me(()=>({...i.modifiers,width:Ce(i.width),height:Ce(i.height),format:i.format,quality:i.quality||f.options.quality,background:i.background,fit:i.fit}));return{options:e,attrs:n,modifiers:c}},Ar={...Rr,placeholder:{type:[Boolean,String,Number,Array],required:!1},placeholderClass:{type:String,required:!1}},Pr=["src"],jr=nr({__name:"NuxtImg",props:Ar,emits:["load","error"],setup(i,{emit:e}){const n=i,f=rr(),c=e,u=!1,g=kn(),p=Cr(n),L=zt(!1),A=zt(),O=Me(()=>g.getSizes(n.src,{...p.options.value,sizes:n.sizes,densities:n.densities,modifiers:{...p.modifiers.value,width:Ce(n.width),height:Ce(n.height)}})),Y=Me(()=>{const ie={...p.attrs.value,"data-nuxt-img":""};return(!n.placeholder||L.value)&&(ie.sizes=O.value.sizes,ie.srcset=O.value.srcset),ie}),se=Me(()=>{let ie=n.placeholder;if(ie===""&&(ie=!0),!ie||L.value)return!1;if(typeof ie=="string")return ie;const _e=Array.isArray(ie)?ie:typeof ie=="number"?[ie,ie]:[10,10];return g(n.src,{...p.modifiers.value,width:_e[0],height:_e[1],quality:_e[2]||50,blur:_e[3]||3},p.options.value)}),ye=Me(()=>n.sizes?O.value.src:g(n.src,p.modifiers.value,p.options.value)),he=Me(()=>se.value?se.value:ye.value),Be=Ln().isHydrating;return Mn(()=>{if(se.value){const ie=new Image;ye.value&&(ie.src=ye.value),n.sizes&&(ie.sizes=O.value.sizes||"",ie.srcset=O.value.srcset),ie.onload=_e=>{L.value=!0,c("load",_e)},Tr("nuxt-image");return}A.value&&(A.value.complete&&Be&&(A.value.getAttribute("data-error")?c("error",new Event("error")):c("load",new Event("load"))),A.value.onload=ie=>{c("load",ie)},A.value.onerror=ie=>{c("error",ie)})}),(ie,_e)=>(xt(),vt("img",ir({ref_key:"imgEl",ref:A,class:n.placeholder&&!L.value?n.placeholderClass:void 0},{...Gt(u)?{onerror:"this.setAttribute('data-error', 1)"}:{},...Y.value,...Gt(f)},{src:he.value}),null,16,Pr))}}),Lr=i=>`${Wn().public.apiBase}/media/${i}/`;var Wr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Nn(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function Mr(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var n=function f(){return this instanceof f?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(i).forEach(function(f){var c=Object.getOwnPropertyDescriptor(i,f);Object.defineProperty(n,f,c.get?c:{enumerable:!0,get:function(){return i[f]}})}),n}var Kn={exports:{}};(function(i){(function(e,n){i.exports?i.exports=n():(e.nacl||(e.nacl={}),e.nacl.util=n())})(Wr,function(){var e={};function n(f){if(!/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(f))throw new TypeError("invalid encoding")}return e.decodeUTF8=function(f){if(typeof f!="string")throw new TypeError("expected string");var c,u=unescape(encodeURIComponent(f)),g=new Uint8Array(u.length);for(c=0;c<u.length;c++)g[c]=u.charCodeAt(c);return g},e.encodeUTF8=function(f){var c,u=[];for(c=0;c<f.length;c++)u.push(String.fromCharCode(f[c]));return decodeURIComponent(escape(u.join("")))},typeof atob>"u"?typeof Buffer.from<"u"?(e.encodeBase64=function(f){return Buffer.from(f).toString("base64")},e.decodeBase64=function(f){return n(f),new Uint8Array(Array.prototype.slice.call(Buffer.from(f,"base64"),0))}):(e.encodeBase64=function(f){return new Buffer(f).toString("base64")},e.decodeBase64=function(f){return n(f),new Uint8Array(Array.prototype.slice.call(new Buffer(f,"base64"),0))}):(e.encodeBase64=function(f){var c,u=[],g=f.length;for(c=0;c<g;c++)u.push(String.fromCharCode(f[c]));return btoa(u.join(""))},e.decodeBase64=function(f){n(f);var c,u=atob(f),g=new Uint8Array(u.length);for(c=0;c<u.length;c++)g[c]=u.charCodeAt(c);return g}),e})})(Kn);var Ir=Kn.exports;const tt=Nn(Ir);function Br(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var qn={exports:{}};const kr={},Nr=Object.freeze(Object.defineProperty({__proto__:null,default:kr},Symbol.toStringTag,{value:"Module"})),Kr=Mr(Nr);(function(i){(function(e){var n=function(r){var s,o=new Float64Array(16);if(r)for(s=0;s<r.length;s++)o[s]=r[s];return o},f=function(){throw new Error("no PRNG")},c=new Uint8Array(16),u=new Uint8Array(32);u[0]=9;var g=n(),p=n([1]),L=n([56129,1]),A=n([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),O=n([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),Y=n([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),se=n([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),ye=n([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function he(r,s,o,t){r[s]=o>>24&255,r[s+1]=o>>16&255,r[s+2]=o>>8&255,r[s+3]=o&255,r[s+4]=t>>24&255,r[s+5]=t>>16&255,r[s+6]=t>>8&255,r[s+7]=t&255}function Ae(r,s,o,t,a){var d,h=0;for(d=0;d<a;d++)h|=r[s+d]^o[t+d];return(1&h-1>>>8)-1}function Be(r,s,o,t){return Ae(r,s,o,t,16)}function ie(r,s,o,t){return Ae(r,s,o,t,32)}function _e(r,s,o,t){for(var a=t[0]&255|(t[1]&255)<<8|(t[2]&255)<<16|(t[3]&255)<<24,d=o[0]&255|(o[1]&255)<<8|(o[2]&255)<<16|(o[3]&255)<<24,h=o[4]&255|(o[5]&255)<<8|(o[6]&255)<<16|(o[7]&255)<<24,b=o[8]&255|(o[9]&255)<<8|(o[10]&255)<<16|(o[11]&255)<<24,S=o[12]&255|(o[13]&255)<<8|(o[14]&255)<<16|(o[15]&255)<<24,M=t[4]&255|(t[5]&255)<<8|(t[6]&255)<<16|(t[7]&255)<<24,U=s[0]&255|(s[1]&255)<<8|(s[2]&255)<<16|(s[3]&255)<<24,te=s[4]&255|(s[5]&255)<<8|(s[6]&255)<<16|(s[7]&255)<<24,C=s[8]&255|(s[9]&255)<<8|(s[10]&255)<<16|(s[11]&255)<<24,N=s[12]&255|(s[13]&255)<<8|(s[14]&255)<<16|(s[15]&255)<<24,K=t[8]&255|(t[9]&255)<<8|(t[10]&255)<<16|(t[11]&255)<<24,z=o[16]&255|(o[17]&255)<<8|(o[18]&255)<<16|(o[19]&255)<<24,F=o[20]&255|(o[21]&255)<<8|(o[22]&255)<<16|(o[23]&255)<<24,q=o[24]&255|(o[25]&255)<<8|(o[26]&255)<<16|(o[27]&255)<<24,D=o[28]&255|(o[29]&255)<<8|(o[30]&255)<<16|(o[31]&255)<<24,$=t[12]&255|(t[13]&255)<<8|(t[14]&255)<<16|(t[15]&255)<<24,P=a,I=d,T=h,j=b,W=S,E=M,x=U,v=te,m=C,y=N,w=K,_=z,B=F,G=q,J=D,H=$,l,X=0;X<20;X+=2)l=P+B|0,W^=l<<7|l>>>25,l=W+P|0,m^=l<<9|l>>>23,l=m+W|0,B^=l<<13|l>>>19,l=B+m|0,P^=l<<18|l>>>14,l=E+I|0,y^=l<<7|l>>>25,l=y+E|0,G^=l<<9|l>>>23,l=G+y|0,I^=l<<13|l>>>19,l=I+G|0,E^=l<<18|l>>>14,l=w+x|0,J^=l<<7|l>>>25,l=J+w|0,T^=l<<9|l>>>23,l=T+J|0,x^=l<<13|l>>>19,l=x+T|0,w^=l<<18|l>>>14,l=H+_|0,j^=l<<7|l>>>25,l=j+H|0,v^=l<<9|l>>>23,l=v+j|0,_^=l<<13|l>>>19,l=_+v|0,H^=l<<18|l>>>14,l=P+j|0,I^=l<<7|l>>>25,l=I+P|0,T^=l<<9|l>>>23,l=T+I|0,j^=l<<13|l>>>19,l=j+T|0,P^=l<<18|l>>>14,l=E+W|0,x^=l<<7|l>>>25,l=x+E|0,v^=l<<9|l>>>23,l=v+x|0,W^=l<<13|l>>>19,l=W+v|0,E^=l<<18|l>>>14,l=w+y|0,_^=l<<7|l>>>25,l=_+w|0,m^=l<<9|l>>>23,l=m+_|0,y^=l<<13|l>>>19,l=y+m|0,w^=l<<18|l>>>14,l=H+J|0,B^=l<<7|l>>>25,l=B+H|0,G^=l<<9|l>>>23,l=G+B|0,J^=l<<13|l>>>19,l=J+G|0,H^=l<<18|l>>>14;P=P+a|0,I=I+d|0,T=T+h|0,j=j+b|0,W=W+S|0,E=E+M|0,x=x+U|0,v=v+te|0,m=m+C|0,y=y+N|0,w=w+K|0,_=_+z|0,B=B+F|0,G=G+q|0,J=J+D|0,H=H+$|0,r[0]=P>>>0&255,r[1]=P>>>8&255,r[2]=P>>>16&255,r[3]=P>>>24&255,r[4]=I>>>0&255,r[5]=I>>>8&255,r[6]=I>>>16&255,r[7]=I>>>24&255,r[8]=T>>>0&255,r[9]=T>>>8&255,r[10]=T>>>16&255,r[11]=T>>>24&255,r[12]=j>>>0&255,r[13]=j>>>8&255,r[14]=j>>>16&255,r[15]=j>>>24&255,r[16]=W>>>0&255,r[17]=W>>>8&255,r[18]=W>>>16&255,r[19]=W>>>24&255,r[20]=E>>>0&255,r[21]=E>>>8&255,r[22]=E>>>16&255,r[23]=E>>>24&255,r[24]=x>>>0&255,r[25]=x>>>8&255,r[26]=x>>>16&255,r[27]=x>>>24&255,r[28]=v>>>0&255,r[29]=v>>>8&255,r[30]=v>>>16&255,r[31]=v>>>24&255,r[32]=m>>>0&255,r[33]=m>>>8&255,r[34]=m>>>16&255,r[35]=m>>>24&255,r[36]=y>>>0&255,r[37]=y>>>8&255,r[38]=y>>>16&255,r[39]=y>>>24&255,r[40]=w>>>0&255,r[41]=w>>>8&255,r[42]=w>>>16&255,r[43]=w>>>24&255,r[44]=_>>>0&255,r[45]=_>>>8&255,r[46]=_>>>16&255,r[47]=_>>>24&255,r[48]=B>>>0&255,r[49]=B>>>8&255,r[50]=B>>>16&255,r[51]=B>>>24&255,r[52]=G>>>0&255,r[53]=G>>>8&255,r[54]=G>>>16&255,r[55]=G>>>24&255,r[56]=J>>>0&255,r[57]=J>>>8&255,r[58]=J>>>16&255,r[59]=J>>>24&255,r[60]=H>>>0&255,r[61]=H>>>8&255,r[62]=H>>>16&255,r[63]=H>>>24&255}function be(r,s,o,t){for(var a=t[0]&255|(t[1]&255)<<8|(t[2]&255)<<16|(t[3]&255)<<24,d=o[0]&255|(o[1]&255)<<8|(o[2]&255)<<16|(o[3]&255)<<24,h=o[4]&255|(o[5]&255)<<8|(o[6]&255)<<16|(o[7]&255)<<24,b=o[8]&255|(o[9]&255)<<8|(o[10]&255)<<16|(o[11]&255)<<24,S=o[12]&255|(o[13]&255)<<8|(o[14]&255)<<16|(o[15]&255)<<24,M=t[4]&255|(t[5]&255)<<8|(t[6]&255)<<16|(t[7]&255)<<24,U=s[0]&255|(s[1]&255)<<8|(s[2]&255)<<16|(s[3]&255)<<24,te=s[4]&255|(s[5]&255)<<8|(s[6]&255)<<16|(s[7]&255)<<24,C=s[8]&255|(s[9]&255)<<8|(s[10]&255)<<16|(s[11]&255)<<24,N=s[12]&255|(s[13]&255)<<8|(s[14]&255)<<16|(s[15]&255)<<24,K=t[8]&255|(t[9]&255)<<8|(t[10]&255)<<16|(t[11]&255)<<24,z=o[16]&255|(o[17]&255)<<8|(o[18]&255)<<16|(o[19]&255)<<24,F=o[20]&255|(o[21]&255)<<8|(o[22]&255)<<16|(o[23]&255)<<24,q=o[24]&255|(o[25]&255)<<8|(o[26]&255)<<16|(o[27]&255)<<24,D=o[28]&255|(o[29]&255)<<8|(o[30]&255)<<16|(o[31]&255)<<24,$=t[12]&255|(t[13]&255)<<8|(t[14]&255)<<16|(t[15]&255)<<24,P=a,I=d,T=h,j=b,W=S,E=M,x=U,v=te,m=C,y=N,w=K,_=z,B=F,G=q,J=D,H=$,l,X=0;X<20;X+=2)l=P+B|0,W^=l<<7|l>>>25,l=W+P|0,m^=l<<9|l>>>23,l=m+W|0,B^=l<<13|l>>>19,l=B+m|0,P^=l<<18|l>>>14,l=E+I|0,y^=l<<7|l>>>25,l=y+E|0,G^=l<<9|l>>>23,l=G+y|0,I^=l<<13|l>>>19,l=I+G|0,E^=l<<18|l>>>14,l=w+x|0,J^=l<<7|l>>>25,l=J+w|0,T^=l<<9|l>>>23,l=T+J|0,x^=l<<13|l>>>19,l=x+T|0,w^=l<<18|l>>>14,l=H+_|0,j^=l<<7|l>>>25,l=j+H|0,v^=l<<9|l>>>23,l=v+j|0,_^=l<<13|l>>>19,l=_+v|0,H^=l<<18|l>>>14,l=P+j|0,I^=l<<7|l>>>25,l=I+P|0,T^=l<<9|l>>>23,l=T+I|0,j^=l<<13|l>>>19,l=j+T|0,P^=l<<18|l>>>14,l=E+W|0,x^=l<<7|l>>>25,l=x+E|0,v^=l<<9|l>>>23,l=v+x|0,W^=l<<13|l>>>19,l=W+v|0,E^=l<<18|l>>>14,l=w+y|0,_^=l<<7|l>>>25,l=_+w|0,m^=l<<9|l>>>23,l=m+_|0,y^=l<<13|l>>>19,l=y+m|0,w^=l<<18|l>>>14,l=H+J|0,B^=l<<7|l>>>25,l=B+H|0,G^=l<<9|l>>>23,l=G+B|0,J^=l<<13|l>>>19,l=J+G|0,H^=l<<18|l>>>14;r[0]=P>>>0&255,r[1]=P>>>8&255,r[2]=P>>>16&255,r[3]=P>>>24&255,r[4]=E>>>0&255,r[5]=E>>>8&255,r[6]=E>>>16&255,r[7]=E>>>24&255,r[8]=w>>>0&255,r[9]=w>>>8&255,r[10]=w>>>16&255,r[11]=w>>>24&255,r[12]=H>>>0&255,r[13]=H>>>8&255,r[14]=H>>>16&255,r[15]=H>>>24&255,r[16]=x>>>0&255,r[17]=x>>>8&255,r[18]=x>>>16&255,r[19]=x>>>24&255,r[20]=v>>>0&255,r[21]=v>>>8&255,r[22]=v>>>16&255,r[23]=v>>>24&255,r[24]=m>>>0&255,r[25]=m>>>8&255,r[26]=m>>>16&255,r[27]=m>>>24&255,r[28]=y>>>0&255,r[29]=y>>>8&255,r[30]=y>>>16&255,r[31]=y>>>24&255}function pe(r,s,o,t){_e(r,s,o,t)}function Ee(r,s,o,t){be(r,s,o,t)}var ke=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function tn(r,s,o,t,a,d,h){var b=new Uint8Array(16),S=new Uint8Array(64),M,U;for(U=0;U<16;U++)b[U]=0;for(U=0;U<8;U++)b[U]=d[U];for(;a>=64;){for(pe(S,b,h,ke),U=0;U<64;U++)r[s+U]=o[t+U]^S[U];for(M=1,U=8;U<16;U++)M=M+(b[U]&255)|0,b[U]=M&255,M>>>=8;a-=64,s+=64,t+=64}if(a>0)for(pe(S,b,h,ke),U=0;U<a;U++)r[s+U]=o[t+U]^S[U];return 0}function nn(r,s,o,t,a){var d=new Uint8Array(16),h=new Uint8Array(64),b,S;for(S=0;S<16;S++)d[S]=0;for(S=0;S<8;S++)d[S]=t[S];for(;o>=64;){for(pe(h,d,a,ke),S=0;S<64;S++)r[s+S]=h[S];for(b=1,S=8;S<16;S++)b=b+(d[S]&255)|0,d[S]=b&255,b>>>=8;o-=64,s+=64}if(o>0)for(pe(h,d,a,ke),S=0;S<o;S++)r[s+S]=h[S];return 0}function rn(r,s,o,t,a){var d=new Uint8Array(32);Ee(d,t,a,ke);for(var h=new Uint8Array(8),b=0;b<8;b++)h[b]=t[b+16];return nn(r,s,o,h,d)}function Rt(r,s,o,t,a,d,h){var b=new Uint8Array(32);Ee(b,d,h,ke);for(var S=new Uint8Array(8),M=0;M<8;M++)S[M]=d[M+16];return tn(r,s,o,t,a,S,b)}var it=function(r){this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0;var s,o,t,a,d,h,b,S;s=r[0]&255|(r[1]&255)<<8,this.r[0]=s&8191,o=r[2]&255|(r[3]&255)<<8,this.r[1]=(s>>>13|o<<3)&8191,t=r[4]&255|(r[5]&255)<<8,this.r[2]=(o>>>10|t<<6)&7939,a=r[6]&255|(r[7]&255)<<8,this.r[3]=(t>>>7|a<<9)&8191,d=r[8]&255|(r[9]&255)<<8,this.r[4]=(a>>>4|d<<12)&255,this.r[5]=d>>>1&8190,h=r[10]&255|(r[11]&255)<<8,this.r[6]=(d>>>14|h<<2)&8191,b=r[12]&255|(r[13]&255)<<8,this.r[7]=(h>>>11|b<<5)&8065,S=r[14]&255|(r[15]&255)<<8,this.r[8]=(b>>>8|S<<8)&8191,this.r[9]=S>>>5&127,this.pad[0]=r[16]&255|(r[17]&255)<<8,this.pad[1]=r[18]&255|(r[19]&255)<<8,this.pad[2]=r[20]&255|(r[21]&255)<<8,this.pad[3]=r[22]&255|(r[23]&255)<<8,this.pad[4]=r[24]&255|(r[25]&255)<<8,this.pad[5]=r[26]&255|(r[27]&255)<<8,this.pad[6]=r[28]&255|(r[29]&255)<<8,this.pad[7]=r[30]&255|(r[31]&255)<<8};it.prototype.blocks=function(r,s,o){for(var t=this.fin?0:2048,a,d,h,b,S,M,U,te,C,N,K,z,F,q,D,$,P,I,T,j=this.h[0],W=this.h[1],E=this.h[2],x=this.h[3],v=this.h[4],m=this.h[5],y=this.h[6],w=this.h[7],_=this.h[8],B=this.h[9],G=this.r[0],J=this.r[1],H=this.r[2],l=this.r[3],X=this.r[4],ne=this.r[5],re=this.r[6],Z=this.r[7],V=this.r[8],ee=this.r[9];o>=16;)a=r[s+0]&255|(r[s+1]&255)<<8,j+=a&8191,d=r[s+2]&255|(r[s+3]&255)<<8,W+=(a>>>13|d<<3)&8191,h=r[s+4]&255|(r[s+5]&255)<<8,E+=(d>>>10|h<<6)&8191,b=r[s+6]&255|(r[s+7]&255)<<8,x+=(h>>>7|b<<9)&8191,S=r[s+8]&255|(r[s+9]&255)<<8,v+=(b>>>4|S<<12)&8191,m+=S>>>1&8191,M=r[s+10]&255|(r[s+11]&255)<<8,y+=(S>>>14|M<<2)&8191,U=r[s+12]&255|(r[s+13]&255)<<8,w+=(M>>>11|U<<5)&8191,te=r[s+14]&255|(r[s+15]&255)<<8,_+=(U>>>8|te<<8)&8191,B+=te>>>5|t,C=0,N=C,N+=j*G,N+=W*(5*ee),N+=E*(5*V),N+=x*(5*Z),N+=v*(5*re),C=N>>>13,N&=8191,N+=m*(5*ne),N+=y*(5*X),N+=w*(5*l),N+=_*(5*H),N+=B*(5*J),C+=N>>>13,N&=8191,K=C,K+=j*J,K+=W*G,K+=E*(5*ee),K+=x*(5*V),K+=v*(5*Z),C=K>>>13,K&=8191,K+=m*(5*re),K+=y*(5*ne),K+=w*(5*X),K+=_*(5*l),K+=B*(5*H),C+=K>>>13,K&=8191,z=C,z+=j*H,z+=W*J,z+=E*G,z+=x*(5*ee),z+=v*(5*V),C=z>>>13,z&=8191,z+=m*(5*Z),z+=y*(5*re),z+=w*(5*ne),z+=_*(5*X),z+=B*(5*l),C+=z>>>13,z&=8191,F=C,F+=j*l,F+=W*H,F+=E*J,F+=x*G,F+=v*(5*ee),C=F>>>13,F&=8191,F+=m*(5*V),F+=y*(5*Z),F+=w*(5*re),F+=_*(5*ne),F+=B*(5*X),C+=F>>>13,F&=8191,q=C,q+=j*X,q+=W*l,q+=E*H,q+=x*J,q+=v*G,C=q>>>13,q&=8191,q+=m*(5*ee),q+=y*(5*V),q+=w*(5*Z),q+=_*(5*re),q+=B*(5*ne),C+=q>>>13,q&=8191,D=C,D+=j*ne,D+=W*X,D+=E*l,D+=x*H,D+=v*J,C=D>>>13,D&=8191,D+=m*G,D+=y*(5*ee),D+=w*(5*V),D+=_*(5*Z),D+=B*(5*re),C+=D>>>13,D&=8191,$=C,$+=j*re,$+=W*ne,$+=E*X,$+=x*l,$+=v*H,C=$>>>13,$&=8191,$+=m*J,$+=y*G,$+=w*(5*ee),$+=_*(5*V),$+=B*(5*Z),C+=$>>>13,$&=8191,P=C,P+=j*Z,P+=W*re,P+=E*ne,P+=x*X,P+=v*l,C=P>>>13,P&=8191,P+=m*H,P+=y*J,P+=w*G,P+=_*(5*ee),P+=B*(5*V),C+=P>>>13,P&=8191,I=C,I+=j*V,I+=W*Z,I+=E*re,I+=x*ne,I+=v*X,C=I>>>13,I&=8191,I+=m*l,I+=y*H,I+=w*J,I+=_*G,I+=B*(5*ee),C+=I>>>13,I&=8191,T=C,T+=j*ee,T+=W*V,T+=E*Z,T+=x*re,T+=v*ne,C=T>>>13,T&=8191,T+=m*X,T+=y*l,T+=w*H,T+=_*J,T+=B*G,C+=T>>>13,T&=8191,C=(C<<2)+C|0,C=C+N|0,N=C&8191,C=C>>>13,K+=C,j=N,W=K,E=z,x=F,v=q,m=D,y=$,w=P,_=I,B=T,s+=16,o-=16;this.h[0]=j,this.h[1]=W,this.h[2]=E,this.h[3]=x,this.h[4]=v,this.h[5]=m,this.h[6]=y,this.h[7]=w,this.h[8]=_,this.h[9]=B},it.prototype.finish=function(r,s){var o=new Uint16Array(10),t,a,d,h;if(this.leftover){for(h=this.leftover,this.buffer[h++]=1;h<16;h++)this.buffer[h]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(t=this.h[1]>>>13,this.h[1]&=8191,h=2;h<10;h++)this.h[h]+=t,t=this.h[h]>>>13,this.h[h]&=8191;for(this.h[0]+=t*5,t=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=t,t=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=t,o[0]=this.h[0]+5,t=o[0]>>>13,o[0]&=8191,h=1;h<10;h++)o[h]=this.h[h]+t,t=o[h]>>>13,o[h]&=8191;for(o[9]-=8192,a=(t^1)-1,h=0;h<10;h++)o[h]&=a;for(a=~a,h=0;h<10;h++)this.h[h]=this.h[h]&a|o[h];for(this.h[0]=(this.h[0]|this.h[1]<<13)&65535,this.h[1]=(this.h[1]>>>3|this.h[2]<<10)&65535,this.h[2]=(this.h[2]>>>6|this.h[3]<<7)&65535,this.h[3]=(this.h[3]>>>9|this.h[4]<<4)&65535,this.h[4]=(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14)&65535,this.h[5]=(this.h[6]>>>2|this.h[7]<<11)&65535,this.h[6]=(this.h[7]>>>5|this.h[8]<<8)&65535,this.h[7]=(this.h[8]>>>8|this.h[9]<<5)&65535,d=this.h[0]+this.pad[0],this.h[0]=d&65535,h=1;h<8;h++)d=(this.h[h]+this.pad[h]|0)+(d>>>16)|0,this.h[h]=d&65535;r[s+0]=this.h[0]>>>0&255,r[s+1]=this.h[0]>>>8&255,r[s+2]=this.h[1]>>>0&255,r[s+3]=this.h[1]>>>8&255,r[s+4]=this.h[2]>>>0&255,r[s+5]=this.h[2]>>>8&255,r[s+6]=this.h[3]>>>0&255,r[s+7]=this.h[3]>>>8&255,r[s+8]=this.h[4]>>>0&255,r[s+9]=this.h[4]>>>8&255,r[s+10]=this.h[5]>>>0&255,r[s+11]=this.h[5]>>>8&255,r[s+12]=this.h[6]>>>0&255,r[s+13]=this.h[6]>>>8&255,r[s+14]=this.h[7]>>>0&255,r[s+15]=this.h[7]>>>8&255},it.prototype.update=function(r,s,o){var t,a;if(this.leftover){for(a=16-this.leftover,a>o&&(a=o),t=0;t<a;t++)this.buffer[this.leftover+t]=r[s+t];if(o-=a,s+=a,this.leftover+=a,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(o>=16&&(a=o-o%16,this.blocks(r,s,a),s+=a,o-=a),o){for(t=0;t<o;t++)this.buffer[this.leftover+t]=r[s+t];this.leftover+=o}};function Ct(r,s,o,t,a,d){var h=new it(d);return h.update(o,t,a),h.finish(r,s),0}function on(r,s,o,t,a,d){var h=new Uint8Array(16);return Ct(h,0,o,t,a,d),Be(r,s,h,0)}function At(r,s,o,t,a){var d;if(o<32)return-1;for(Rt(r,0,s,0,o,t,a),Ct(r,16,r,32,o-32,r),d=0;d<16;d++)r[d]=0;return 0}function Pt(r,s,o,t,a){var d,h=new Uint8Array(32);if(o<32||(rn(h,0,32,t,a),on(s,16,s,32,o-32,h)!==0))return-1;for(Rt(r,0,s,0,o,t,a),d=0;d<32;d++)r[d]=0;return 0}function Pe(r,s){var o;for(o=0;o<16;o++)r[o]=s[o]|0}function jt(r){var s,o,t=1;for(s=0;s<16;s++)o=r[s]+t+65535,t=Math.floor(o/65536),r[s]=o-t*65536;r[0]+=t-1+37*(t-1)}function qe(r,s,o){for(var t,a=~(o-1),d=0;d<16;d++)t=a&(r[d]^s[d]),r[d]^=t,s[d]^=t}function $e(r,s){var o,t,a,d=n(),h=n();for(o=0;o<16;o++)h[o]=s[o];for(jt(h),jt(h),jt(h),t=0;t<2;t++){for(d[0]=h[0]-65517,o=1;o<15;o++)d[o]=h[o]-65535-(d[o-1]>>16&1),d[o-1]&=65535;d[15]=h[15]-32767-(d[14]>>16&1),a=d[15]>>16&1,d[14]&=65535,qe(h,d,1-a)}for(o=0;o<16;o++)r[2*o]=h[o]&255,r[2*o+1]=h[o]>>8}function sn(r,s){var o=new Uint8Array(32),t=new Uint8Array(32);return $e(o,r),$e(t,s),ie(o,0,t,0)}function an(r){var s=new Uint8Array(32);return $e(s,r),s[0]&1}function Lt(r,s){var o;for(o=0;o<16;o++)r[o]=s[2*o]+(s[2*o+1]<<8);r[15]&=32767}function Ue(r,s,o){for(var t=0;t<16;t++)r[t]=s[t]+o[t]}function Te(r,s,o){for(var t=0;t<16;t++)r[t]=s[t]-o[t]}function Q(r,s,o){var t,a,d=0,h=0,b=0,S=0,M=0,U=0,te=0,C=0,N=0,K=0,z=0,F=0,q=0,D=0,$=0,P=0,I=0,T=0,j=0,W=0,E=0,x=0,v=0,m=0,y=0,w=0,_=0,B=0,G=0,J=0,H=0,l=o[0],X=o[1],ne=o[2],re=o[3],Z=o[4],V=o[5],ee=o[6],le=o[7],oe=o[8],ae=o[9],fe=o[10],ce=o[11],de=o[12],ge=o[13],xe=o[14],ve=o[15];t=s[0],d+=t*l,h+=t*X,b+=t*ne,S+=t*re,M+=t*Z,U+=t*V,te+=t*ee,C+=t*le,N+=t*oe,K+=t*ae,z+=t*fe,F+=t*ce,q+=t*de,D+=t*ge,$+=t*xe,P+=t*ve,t=s[1],h+=t*l,b+=t*X,S+=t*ne,M+=t*re,U+=t*Z,te+=t*V,C+=t*ee,N+=t*le,K+=t*oe,z+=t*ae,F+=t*fe,q+=t*ce,D+=t*de,$+=t*ge,P+=t*xe,I+=t*ve,t=s[2],b+=t*l,S+=t*X,M+=t*ne,U+=t*re,te+=t*Z,C+=t*V,N+=t*ee,K+=t*le,z+=t*oe,F+=t*ae,q+=t*fe,D+=t*ce,$+=t*de,P+=t*ge,I+=t*xe,T+=t*ve,t=s[3],S+=t*l,M+=t*X,U+=t*ne,te+=t*re,C+=t*Z,N+=t*V,K+=t*ee,z+=t*le,F+=t*oe,q+=t*ae,D+=t*fe,$+=t*ce,P+=t*de,I+=t*ge,T+=t*xe,j+=t*ve,t=s[4],M+=t*l,U+=t*X,te+=t*ne,C+=t*re,N+=t*Z,K+=t*V,z+=t*ee,F+=t*le,q+=t*oe,D+=t*ae,$+=t*fe,P+=t*ce,I+=t*de,T+=t*ge,j+=t*xe,W+=t*ve,t=s[5],U+=t*l,te+=t*X,C+=t*ne,N+=t*re,K+=t*Z,z+=t*V,F+=t*ee,q+=t*le,D+=t*oe,$+=t*ae,P+=t*fe,I+=t*ce,T+=t*de,j+=t*ge,W+=t*xe,E+=t*ve,t=s[6],te+=t*l,C+=t*X,N+=t*ne,K+=t*re,z+=t*Z,F+=t*V,q+=t*ee,D+=t*le,$+=t*oe,P+=t*ae,I+=t*fe,T+=t*ce,j+=t*de,W+=t*ge,E+=t*xe,x+=t*ve,t=s[7],C+=t*l,N+=t*X,K+=t*ne,z+=t*re,F+=t*Z,q+=t*V,D+=t*ee,$+=t*le,P+=t*oe,I+=t*ae,T+=t*fe,j+=t*ce,W+=t*de,E+=t*ge,x+=t*xe,v+=t*ve,t=s[8],N+=t*l,K+=t*X,z+=t*ne,F+=t*re,q+=t*Z,D+=t*V,$+=t*ee,P+=t*le,I+=t*oe,T+=t*ae,j+=t*fe,W+=t*ce,E+=t*de,x+=t*ge,v+=t*xe,m+=t*ve,t=s[9],K+=t*l,z+=t*X,F+=t*ne,q+=t*re,D+=t*Z,$+=t*V,P+=t*ee,I+=t*le,T+=t*oe,j+=t*ae,W+=t*fe,E+=t*ce,x+=t*de,v+=t*ge,m+=t*xe,y+=t*ve,t=s[10],z+=t*l,F+=t*X,q+=t*ne,D+=t*re,$+=t*Z,P+=t*V,I+=t*ee,T+=t*le,j+=t*oe,W+=t*ae,E+=t*fe,x+=t*ce,v+=t*de,m+=t*ge,y+=t*xe,w+=t*ve,t=s[11],F+=t*l,q+=t*X,D+=t*ne,$+=t*re,P+=t*Z,I+=t*V,T+=t*ee,j+=t*le,W+=t*oe,E+=t*ae,x+=t*fe,v+=t*ce,m+=t*de,y+=t*ge,w+=t*xe,_+=t*ve,t=s[12],q+=t*l,D+=t*X,$+=t*ne,P+=t*re,I+=t*Z,T+=t*V,j+=t*ee,W+=t*le,E+=t*oe,x+=t*ae,v+=t*fe,m+=t*ce,y+=t*de,w+=t*ge,_+=t*xe,B+=t*ve,t=s[13],D+=t*l,$+=t*X,P+=t*ne,I+=t*re,T+=t*Z,j+=t*V,W+=t*ee,E+=t*le,x+=t*oe,v+=t*ae,m+=t*fe,y+=t*ce,w+=t*de,_+=t*ge,B+=t*xe,G+=t*ve,t=s[14],$+=t*l,P+=t*X,I+=t*ne,T+=t*re,j+=t*Z,W+=t*V,E+=t*ee,x+=t*le,v+=t*oe,m+=t*ae,y+=t*fe,w+=t*ce,_+=t*de,B+=t*ge,G+=t*xe,J+=t*ve,t=s[15],P+=t*l,I+=t*X,T+=t*ne,j+=t*re,W+=t*Z,E+=t*V,x+=t*ee,v+=t*le,m+=t*oe,y+=t*ae,w+=t*fe,_+=t*ce,B+=t*de,G+=t*ge,J+=t*xe,H+=t*ve,d+=38*I,h+=38*T,b+=38*j,S+=38*W,M+=38*E,U+=38*x,te+=38*v,C+=38*m,N+=38*y,K+=38*w,z+=38*_,F+=38*B,q+=38*G,D+=38*J,$+=38*H,a=1,t=d+a+65535,a=Math.floor(t/65536),d=t-a*65536,t=h+a+65535,a=Math.floor(t/65536),h=t-a*65536,t=b+a+65535,a=Math.floor(t/65536),b=t-a*65536,t=S+a+65535,a=Math.floor(t/65536),S=t-a*65536,t=M+a+65535,a=Math.floor(t/65536),M=t-a*65536,t=U+a+65535,a=Math.floor(t/65536),U=t-a*65536,t=te+a+65535,a=Math.floor(t/65536),te=t-a*65536,t=C+a+65535,a=Math.floor(t/65536),C=t-a*65536,t=N+a+65535,a=Math.floor(t/65536),N=t-a*65536,t=K+a+65535,a=Math.floor(t/65536),K=t-a*65536,t=z+a+65535,a=Math.floor(t/65536),z=t-a*65536,t=F+a+65535,a=Math.floor(t/65536),F=t-a*65536,t=q+a+65535,a=Math.floor(t/65536),q=t-a*65536,t=D+a+65535,a=Math.floor(t/65536),D=t-a*65536,t=$+a+65535,a=Math.floor(t/65536),$=t-a*65536,t=P+a+65535,a=Math.floor(t/65536),P=t-a*65536,d+=a-1+37*(a-1),a=1,t=d+a+65535,a=Math.floor(t/65536),d=t-a*65536,t=h+a+65535,a=Math.floor(t/65536),h=t-a*65536,t=b+a+65535,a=Math.floor(t/65536),b=t-a*65536,t=S+a+65535,a=Math.floor(t/65536),S=t-a*65536,t=M+a+65535,a=Math.floor(t/65536),M=t-a*65536,t=U+a+65535,a=Math.floor(t/65536),U=t-a*65536,t=te+a+65535,a=Math.floor(t/65536),te=t-a*65536,t=C+a+65535,a=Math.floor(t/65536),C=t-a*65536,t=N+a+65535,a=Math.floor(t/65536),N=t-a*65536,t=K+a+65535,a=Math.floor(t/65536),K=t-a*65536,t=z+a+65535,a=Math.floor(t/65536),z=t-a*65536,t=F+a+65535,a=Math.floor(t/65536),F=t-a*65536,t=q+a+65535,a=Math.floor(t/65536),q=t-a*65536,t=D+a+65535,a=Math.floor(t/65536),D=t-a*65536,t=$+a+65535,a=Math.floor(t/65536),$=t-a*65536,t=P+a+65535,a=Math.floor(t/65536),P=t-a*65536,d+=a-1+37*(a-1),r[0]=d,r[1]=h,r[2]=b,r[3]=S,r[4]=M,r[5]=U,r[6]=te,r[7]=C,r[8]=N,r[9]=K,r[10]=z,r[11]=F,r[12]=q,r[13]=D,r[14]=$,r[15]=P}function Se(r,s){Q(r,s,s)}function fn(r,s){var o=n(),t;for(t=0;t<16;t++)o[t]=s[t];for(t=253;t>=0;t--)Se(o,o),t!==2&&t!==4&&Q(o,o,s);for(t=0;t<16;t++)r[t]=o[t]}function cn(r,s){var o=n(),t;for(t=0;t<16;t++)o[t]=s[t];for(t=250;t>=0;t--)Se(o,o),t!==1&&Q(o,o,s);for(t=0;t<16;t++)r[t]=o[t]}function ot(r,s,o){var t=new Uint8Array(32),a=new Float64Array(80),d,h,b=n(),S=n(),M=n(),U=n(),te=n(),C=n();for(h=0;h<31;h++)t[h]=s[h];for(t[31]=s[31]&127|64,t[0]&=248,Lt(a,o),h=0;h<16;h++)S[h]=a[h],U[h]=b[h]=M[h]=0;for(b[0]=U[0]=1,h=254;h>=0;--h)d=t[h>>>3]>>>(h&7)&1,qe(b,S,d),qe(M,U,d),Ue(te,b,M),Te(b,b,M),Ue(M,S,U),Te(S,S,U),Se(U,te),Se(C,b),Q(b,M,b),Q(M,S,te),Ue(te,b,M),Te(b,b,M),Se(S,b),Te(M,U,C),Q(b,M,L),Ue(b,b,U),Q(M,M,b),Q(b,U,C),Q(U,S,a),Se(S,te),qe(b,S,d),qe(M,U,d);for(h=0;h<16;h++)a[h+16]=b[h],a[h+32]=M[h],a[h+48]=S[h],a[h+64]=U[h];var N=a.subarray(32),K=a.subarray(16);return fn(N,N),Q(K,K,N),$e(r,K),0}function st(r,s){return ot(r,s,u)}function ln(r,s){return f(s,32),st(r,s)}function at(r,s,o){var t=new Uint8Array(32);return ot(t,o,s),Ee(r,c,t,ke)}var dn=At,zn=Pt;function Gn(r,s,o,t,a,d){var h=new Uint8Array(32);return at(h,a,d),dn(r,s,o,t,h)}function Hn(r,s,o,t,a,d){var h=new Uint8Array(32);return at(h,a,d),zn(r,s,o,t,h)}var un=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function hn(r,s,o,t){for(var a=new Int32Array(16),d=new Int32Array(16),h,b,S,M,U,te,C,N,K,z,F,q,D,$,P,I,T,j,W,E,x,v,m,y,w,_,B=r[0],G=r[1],J=r[2],H=r[3],l=r[4],X=r[5],ne=r[6],re=r[7],Z=s[0],V=s[1],ee=s[2],le=s[3],oe=s[4],ae=s[5],fe=s[6],ce=s[7],de=0;t>=128;){for(W=0;W<16;W++)E=8*W+de,a[W]=o[E+0]<<24|o[E+1]<<16|o[E+2]<<8|o[E+3],d[W]=o[E+4]<<24|o[E+5]<<16|o[E+6]<<8|o[E+7];for(W=0;W<80;W++)if(h=B,b=G,S=J,M=H,U=l,te=X,C=ne,N=re,K=Z,z=V,F=ee,q=le,D=oe,$=ae,P=fe,I=ce,x=re,v=ce,m=v&65535,y=v>>>16,w=x&65535,_=x>>>16,x=(l>>>14|oe<<18)^(l>>>18|oe<<14)^(oe>>>9|l<<23),v=(oe>>>14|l<<18)^(oe>>>18|l<<14)^(l>>>9|oe<<23),m+=v&65535,y+=v>>>16,w+=x&65535,_+=x>>>16,x=l&X^~l&ne,v=oe&ae^~oe&fe,m+=v&65535,y+=v>>>16,w+=x&65535,_+=x>>>16,x=un[W*2],v=un[W*2+1],m+=v&65535,y+=v>>>16,w+=x&65535,_+=x>>>16,x=a[W%16],v=d[W%16],m+=v&65535,y+=v>>>16,w+=x&65535,_+=x>>>16,y+=m>>>16,w+=y>>>16,_+=w>>>16,T=w&65535|_<<16,j=m&65535|y<<16,x=T,v=j,m=v&65535,y=v>>>16,w=x&65535,_=x>>>16,x=(B>>>28|Z<<4)^(Z>>>2|B<<30)^(Z>>>7|B<<25),v=(Z>>>28|B<<4)^(B>>>2|Z<<30)^(B>>>7|Z<<25),m+=v&65535,y+=v>>>16,w+=x&65535,_+=x>>>16,x=B&G^B&J^G&J,v=Z&V^Z&ee^V&ee,m+=v&65535,y+=v>>>16,w+=x&65535,_+=x>>>16,y+=m>>>16,w+=y>>>16,_+=w>>>16,N=w&65535|_<<16,I=m&65535|y<<16,x=M,v=q,m=v&65535,y=v>>>16,w=x&65535,_=x>>>16,x=T,v=j,m+=v&65535,y+=v>>>16,w+=x&65535,_+=x>>>16,y+=m>>>16,w+=y>>>16,_+=w>>>16,M=w&65535|_<<16,q=m&65535|y<<16,G=h,J=b,H=S,l=M,X=U,ne=te,re=C,B=N,V=K,ee=z,le=F,oe=q,ae=D,fe=$,ce=P,Z=I,W%16===15)for(E=0;E<16;E++)x=a[E],v=d[E],m=v&65535,y=v>>>16,w=x&65535,_=x>>>16,x=a[(E+9)%16],v=d[(E+9)%16],m+=v&65535,y+=v>>>16,w+=x&65535,_+=x>>>16,T=a[(E+1)%16],j=d[(E+1)%16],x=(T>>>1|j<<31)^(T>>>8|j<<24)^T>>>7,v=(j>>>1|T<<31)^(j>>>8|T<<24)^(j>>>7|T<<25),m+=v&65535,y+=v>>>16,w+=x&65535,_+=x>>>16,T=a[(E+14)%16],j=d[(E+14)%16],x=(T>>>19|j<<13)^(j>>>29|T<<3)^T>>>6,v=(j>>>19|T<<13)^(T>>>29|j<<3)^(j>>>6|T<<26),m+=v&65535,y+=v>>>16,w+=x&65535,_+=x>>>16,y+=m>>>16,w+=y>>>16,_+=w>>>16,a[E]=w&65535|_<<16,d[E]=m&65535|y<<16;x=B,v=Z,m=v&65535,y=v>>>16,w=x&65535,_=x>>>16,x=r[0],v=s[0],m+=v&65535,y+=v>>>16,w+=x&65535,_+=x>>>16,y+=m>>>16,w+=y>>>16,_+=w>>>16,r[0]=B=w&65535|_<<16,s[0]=Z=m&65535|y<<16,x=G,v=V,m=v&65535,y=v>>>16,w=x&65535,_=x>>>16,x=r[1],v=s[1],m+=v&65535,y+=v>>>16,w+=x&65535,_+=x>>>16,y+=m>>>16,w+=y>>>16,_+=w>>>16,r[1]=G=w&65535|_<<16,s[1]=V=m&65535|y<<16,x=J,v=ee,m=v&65535,y=v>>>16,w=x&65535,_=x>>>16,x=r[2],v=s[2],m+=v&65535,y+=v>>>16,w+=x&65535,_+=x>>>16,y+=m>>>16,w+=y>>>16,_+=w>>>16,r[2]=J=w&65535|_<<16,s[2]=ee=m&65535|y<<16,x=H,v=le,m=v&65535,y=v>>>16,w=x&65535,_=x>>>16,x=r[3],v=s[3],m+=v&65535,y+=v>>>16,w+=x&65535,_+=x>>>16,y+=m>>>16,w+=y>>>16,_+=w>>>16,r[3]=H=w&65535|_<<16,s[3]=le=m&65535|y<<16,x=l,v=oe,m=v&65535,y=v>>>16,w=x&65535,_=x>>>16,x=r[4],v=s[4],m+=v&65535,y+=v>>>16,w+=x&65535,_+=x>>>16,y+=m>>>16,w+=y>>>16,_+=w>>>16,r[4]=l=w&65535|_<<16,s[4]=oe=m&65535|y<<16,x=X,v=ae,m=v&65535,y=v>>>16,w=x&65535,_=x>>>16,x=r[5],v=s[5],m+=v&65535,y+=v>>>16,w+=x&65535,_+=x>>>16,y+=m>>>16,w+=y>>>16,_+=w>>>16,r[5]=X=w&65535|_<<16,s[5]=ae=m&65535|y<<16,x=ne,v=fe,m=v&65535,y=v>>>16,w=x&65535,_=x>>>16,x=r[6],v=s[6],m+=v&65535,y+=v>>>16,w+=x&65535,_+=x>>>16,y+=m>>>16,w+=y>>>16,_+=w>>>16,r[6]=ne=w&65535|_<<16,s[6]=fe=m&65535|y<<16,x=re,v=ce,m=v&65535,y=v>>>16,w=x&65535,_=x>>>16,x=r[7],v=s[7],m+=v&65535,y+=v>>>16,w+=x&65535,_+=x>>>16,y+=m>>>16,w+=y>>>16,_+=w>>>16,r[7]=re=w&65535|_<<16,s[7]=ce=m&65535|y<<16,de+=128,t-=128}return t}function Ne(r,s,o){var t=new Int32Array(8),a=new Int32Array(8),d=new Uint8Array(256),h,b=o;for(t[0]=1779033703,t[1]=3144134277,t[2]=1013904242,t[3]=2773480762,t[4]=1359893119,t[5]=2600822924,t[6]=528734635,t[7]=1541459225,a[0]=4089235720,a[1]=2227873595,a[2]=4271175723,a[3]=1595750129,a[4]=2917565137,a[5]=725511199,a[6]=4215389547,a[7]=327033209,hn(t,a,s,o),o%=128,h=0;h<o;h++)d[h]=s[b-o+h];for(d[o]=128,o=256-128*(o<112?1:0),d[o-9]=0,he(d,o-8,b/536870912|0,b<<3),hn(t,a,d,o),h=0;h<8;h++)he(r,8*h,t[h],a[h]);return 0}function ft(r,s){var o=n(),t=n(),a=n(),d=n(),h=n(),b=n(),S=n(),M=n(),U=n();Te(o,r[1],r[0]),Te(U,s[1],s[0]),Q(o,o,U),Ue(t,r[0],r[1]),Ue(U,s[0],s[1]),Q(t,t,U),Q(a,r[3],s[3]),Q(a,a,O),Q(d,r[2],s[2]),Ue(d,d,d),Te(h,t,o),Te(b,d,a),Ue(S,d,a),Ue(M,t,o),Q(r[0],h,b),Q(r[1],M,S),Q(r[2],S,b),Q(r[3],h,M)}function gn(r,s,o){var t;for(t=0;t<4;t++)qe(r[t],s[t],o)}function Wt(r,s){var o=n(),t=n(),a=n();fn(a,s[2]),Q(o,s[0],a),Q(t,s[1],a),$e(r,t),r[31]^=an(o)<<7}function Mt(r,s,o){var t,a;for(Pe(r[0],g),Pe(r[1],p),Pe(r[2],p),Pe(r[3],g),a=255;a>=0;--a)t=o[a/8|0]>>(a&7)&1,gn(r,s,t),ft(s,r),ft(r,r),gn(r,s,t)}function ct(r,s){var o=[n(),n(),n(),n()];Pe(o[0],Y),Pe(o[1],se),Pe(o[2],p),Q(o[3],Y,se),Mt(r,o,s)}function It(r,s,o){var t=new Uint8Array(64),a=[n(),n(),n(),n()],d;for(o||f(s,32),Ne(t,s,32),t[0]&=248,t[31]&=127,t[31]|=64,ct(a,t),Wt(r,a),d=0;d<32;d++)s[d+32]=r[d];return 0}var lt=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function Bt(r,s){var o,t,a,d;for(t=63;t>=32;--t){for(o=0,a=t-32,d=t-12;a<d;++a)s[a]+=o-16*s[t]*lt[a-(t-32)],o=Math.floor((s[a]+128)/256),s[a]-=o*256;s[a]+=o,s[t]=0}for(o=0,a=0;a<32;a++)s[a]+=o-(s[31]>>4)*lt[a],o=s[a]>>8,s[a]&=255;for(a=0;a<32;a++)s[a]-=o*lt[a];for(t=0;t<32;t++)s[t+1]+=s[t]>>8,r[t]=s[t]&255}function kt(r){var s=new Float64Array(64),o;for(o=0;o<64;o++)s[o]=r[o];for(o=0;o<64;o++)r[o]=0;Bt(r,s)}function xn(r,s,o,t){var a=new Uint8Array(64),d=new Uint8Array(64),h=new Uint8Array(64),b,S,M=new Float64Array(64),U=[n(),n(),n(),n()];Ne(a,t,32),a[0]&=248,a[31]&=127,a[31]|=64;var te=o+64;for(b=0;b<o;b++)r[64+b]=s[b];for(b=0;b<32;b++)r[32+b]=a[32+b];for(Ne(h,r.subarray(32),o+32),kt(h),ct(U,h),Wt(r,U),b=32;b<64;b++)r[b]=t[b];for(Ne(d,r,o+64),kt(d),b=0;b<64;b++)M[b]=0;for(b=0;b<32;b++)M[b]=h[b];for(b=0;b<32;b++)for(S=0;S<32;S++)M[b+S]+=d[b]*a[S];return Bt(r.subarray(32),M),te}function Jn(r,s){var o=n(),t=n(),a=n(),d=n(),h=n(),b=n(),S=n();return Pe(r[2],p),Lt(r[1],s),Se(a,r[1]),Q(d,a,A),Te(a,a,r[2]),Ue(d,r[2],d),Se(h,d),Se(b,h),Q(S,b,h),Q(o,S,a),Q(o,o,d),cn(o,o),Q(o,o,a),Q(o,o,d),Q(o,o,d),Q(r[0],o,d),Se(t,r[0]),Q(t,t,d),sn(t,a)&&Q(r[0],r[0],ye),Se(t,r[0]),Q(t,t,d),sn(t,a)?-1:(an(r[0])===s[31]>>7&&Te(r[0],g,r[0]),Q(r[3],r[0],r[1]),0)}function Nt(r,s,o,t){var a,d=new Uint8Array(32),h=new Uint8Array(64),b=[n(),n(),n(),n()],S=[n(),n(),n(),n()];if(o<64||Jn(S,t))return-1;for(a=0;a<o;a++)r[a]=s[a];for(a=0;a<32;a++)r[a+32]=t[a];if(Ne(h,r,o),kt(h),Mt(b,S,h),ct(S,s.subarray(32)),ft(b,S),Wt(d,b),o-=64,ie(s,0,d,0)){for(a=0;a<o;a++)r[a]=0;return-1}for(a=0;a<o;a++)r[a]=s[a+64];return o}var Kt=32,dt=24,He=32,De=16,Je=32,ut=32,Ze=32,Xe=32,qt=32,vn=dt,Zn=He,Xn=De,je=64,Ke=32,Oe=64,$t=32,Dt=64;e.lowlevel={crypto_core_hsalsa20:Ee,crypto_stream_xor:Rt,crypto_stream:rn,crypto_stream_salsa20_xor:tn,crypto_stream_salsa20:nn,crypto_onetimeauth:Ct,crypto_onetimeauth_verify:on,crypto_verify_16:Be,crypto_verify_32:ie,crypto_secretbox:At,crypto_secretbox_open:Pt,crypto_scalarmult:ot,crypto_scalarmult_base:st,crypto_box_beforenm:at,crypto_box_afternm:dn,crypto_box:Gn,crypto_box_open:Hn,crypto_box_keypair:ln,crypto_hash:Ne,crypto_sign:xn,crypto_sign_keypair:It,crypto_sign_open:Nt,crypto_secretbox_KEYBYTES:Kt,crypto_secretbox_NONCEBYTES:dt,crypto_secretbox_ZEROBYTES:He,crypto_secretbox_BOXZEROBYTES:De,crypto_scalarmult_BYTES:Je,crypto_scalarmult_SCALARBYTES:ut,crypto_box_PUBLICKEYBYTES:Ze,crypto_box_SECRETKEYBYTES:Xe,crypto_box_BEFORENMBYTES:qt,crypto_box_NONCEBYTES:vn,crypto_box_ZEROBYTES:Zn,crypto_box_BOXZEROBYTES:Xn,crypto_sign_BYTES:je,crypto_sign_PUBLICKEYBYTES:Ke,crypto_sign_SECRETKEYBYTES:Oe,crypto_sign_SEEDBYTES:$t,crypto_hash_BYTES:Dt,gf:n,D:A,L:lt,pack25519:$e,unpack25519:Lt,M:Q,A:Ue,S:Se,Z:Te,pow2523:cn,add:ft,set25519:Pe,modL:Bt,scalarmult:Mt,scalarbase:ct};function pn(r,s){if(r.length!==Kt)throw new Error("bad key size");if(s.length!==dt)throw new Error("bad nonce size")}function Qn(r,s){if(r.length!==Ze)throw new Error("bad public key size");if(s.length!==Xe)throw new Error("bad secret key size")}function me(){for(var r=0;r<arguments.length;r++)if(!(arguments[r]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function yn(r){for(var s=0;s<r.length;s++)r[s]=0}e.randomBytes=function(r){var s=new Uint8Array(r);return f(s,r),s},e.secretbox=function(r,s,o){me(r,s,o),pn(o,s);for(var t=new Uint8Array(He+r.length),a=new Uint8Array(t.length),d=0;d<r.length;d++)t[d+He]=r[d];return At(a,t,t.length,s,o),a.subarray(De)},e.secretbox.open=function(r,s,o){me(r,s,o),pn(o,s);for(var t=new Uint8Array(De+r.length),a=new Uint8Array(t.length),d=0;d<r.length;d++)t[d+De]=r[d];return t.length<32||Pt(a,t,t.length,s,o)!==0?null:a.subarray(He)},e.secretbox.keyLength=Kt,e.secretbox.nonceLength=dt,e.secretbox.overheadLength=De,e.scalarMult=function(r,s){if(me(r,s),r.length!==ut)throw new Error("bad n size");if(s.length!==Je)throw new Error("bad p size");var o=new Uint8Array(Je);return ot(o,r,s),o},e.scalarMult.base=function(r){if(me(r),r.length!==ut)throw new Error("bad n size");var s=new Uint8Array(Je);return st(s,r),s},e.scalarMult.scalarLength=ut,e.scalarMult.groupElementLength=Je,e.box=function(r,s,o,t){var a=e.box.before(o,t);return e.secretbox(r,s,a)},e.box.before=function(r,s){me(r,s),Qn(r,s);var o=new Uint8Array(qt);return at(o,r,s),o},e.box.after=e.secretbox,e.box.open=function(r,s,o,t){var a=e.box.before(o,t);return e.secretbox.open(r,s,a)},e.box.open.after=e.secretbox.open,e.box.keyPair=function(){var r=new Uint8Array(Ze),s=new Uint8Array(Xe);return ln(r,s),{publicKey:r,secretKey:s}},e.box.keyPair.fromSecretKey=function(r){if(me(r),r.length!==Xe)throw new Error("bad secret key size");var s=new Uint8Array(Ze);return st(s,r),{publicKey:s,secretKey:new Uint8Array(r)}},e.box.publicKeyLength=Ze,e.box.secretKeyLength=Xe,e.box.sharedKeyLength=qt,e.box.nonceLength=vn,e.box.overheadLength=e.secretbox.overheadLength,e.sign=function(r,s){if(me(r,s),s.length!==Oe)throw new Error("bad secret key size");var o=new Uint8Array(je+r.length);return xn(o,r,r.length,s),o},e.sign.open=function(r,s){if(me(r,s),s.length!==Ke)throw new Error("bad public key size");var o=new Uint8Array(r.length),t=Nt(o,r,r.length,s);if(t<0)return null;for(var a=new Uint8Array(t),d=0;d<a.length;d++)a[d]=o[d];return a},e.sign.detached=function(r,s){for(var o=e.sign(r,s),t=new Uint8Array(je),a=0;a<t.length;a++)t[a]=o[a];return t},e.sign.detached.verify=function(r,s,o){if(me(r,s,o),s.length!==je)throw new Error("bad signature size");if(o.length!==Ke)throw new Error("bad public key size");var t=new Uint8Array(je+r.length),a=new Uint8Array(je+r.length),d;for(d=0;d<je;d++)t[d]=s[d];for(d=0;d<r.length;d++)t[d+je]=r[d];return Nt(a,t,t.length,o)>=0},e.sign.keyPair=function(){var r=new Uint8Array(Ke),s=new Uint8Array(Oe);return It(r,s),{publicKey:r,secretKey:s}},e.sign.keyPair.fromSecretKey=function(r){if(me(r),r.length!==Oe)throw new Error("bad secret key size");for(var s=new Uint8Array(Ke),o=0;o<s.length;o++)s[o]=r[32+o];return{publicKey:s,secretKey:new Uint8Array(r)}},e.sign.keyPair.fromSeed=function(r){if(me(r),r.length!==$t)throw new Error("bad seed size");for(var s=new Uint8Array(Ke),o=new Uint8Array(Oe),t=0;t<32;t++)o[t]=r[t];return It(s,o,!0),{publicKey:s,secretKey:o}},e.sign.publicKeyLength=Ke,e.sign.secretKeyLength=Oe,e.sign.seedLength=$t,e.sign.signatureLength=je,e.hash=function(r){me(r);var s=new Uint8Array(Dt);return Ne(s,r,r.length),s},e.hash.hashLength=Dt,e.verify=function(r,s){return me(r,s),r.length===0||s.length===0||r.length!==s.length?!1:Ae(r,0,s,0,r.length)===0},e.setPRNG=function(r){f=r},function(){var r=typeof self<"u"?self.crypto||self.msCrypto:null;if(r&&r.getRandomValues){var s=65536;e.setPRNG(function(o,t){var a,d=new Uint8Array(t);for(a=0;a<t;a+=s)r.getRandomValues(d.subarray(a,a+Math.min(t-a,s)));for(a=0;a<t;a++)o[a]=d[a];yn(d)})}else typeof Br<"u"&&(r=Kr,r&&r.randomBytes&&e.setPRNG(function(o,t){var a,d=r.randomBytes(t);for(a=0;a<t;a++)o[a]=d[a];yn(d)}))}()})(i.exports?i.exports:self.nacl=self.nacl||{})})(qn);var qr=qn.exports;const ht=Nn(qr);var We;(function(i){i[i.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",i[i.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",i[i.MANIFEST_NOT_FOUND_ERROR=2]="MANIFEST_NOT_FOUND_ERROR",i[i.MANIFEST_CONTENT_ERROR=3]="MANIFEST_CONTENT_ERROR",i[i.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",i[i.USER_REJECTS_ERROR=300]="USER_REJECTS_ERROR",i[i.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"})(We||(We={}));var En;(function(i){i[i.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",i[i.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"})(En||(En={}));var Fe;(function(i){i[i.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",i[i.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",i[i.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",i[i.USER_REJECTS_ERROR=300]="USER_REJECTS_ERROR",i[i.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"})(Fe||(Fe={}));var Un;(function(i){i[i.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",i[i.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",i[i.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",i[i.USER_REJECTS_ERROR=300]="USER_REJECTS_ERROR",i[i.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"})(Un||(Un={}));var Tn;(function(i){i[i.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",i[i.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",i[i.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",i[i.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"})(Tn||(Tn={}));var Rn;(function(i){i.MAINNET="-239",i.TESTNET="-3"})(Rn||(Rn={}));function $r(i,e){const n=tt.encodeBase64(i);return e?encodeURIComponent(n):n}function Dr(i,e){return e&&(i=decodeURIComponent(i)),tt.decodeBase64(i)}function Or(i,e=!1){let n;return i instanceof Uint8Array?n=i:(typeof i!="string"&&(i=JSON.stringify(i)),n=tt.decodeUTF8(i)),$r(n,e)}function Fr(i,e=!1){const n=Dr(i,e);return{toString(){return tt.encodeUTF8(n)},toObject(){try{return JSON.parse(tt.encodeUTF8(n))}catch{return null}},toUint8Array(){return n}}}const $n={encode:Or,decode:Fr};function Yr(i,e){const n=new Uint8Array(i.length+e.length);return n.set(i),n.set(e,i.length),n}function zr(i,e){if(e>=i.length)throw new Error("Index is out of buffer");const n=i.slice(0,e),f=i.slice(e);return[n,f]}function Ot(i){let e="";return i.forEach(n=>{e+=("0"+(n&255).toString(16)).slice(-2)}),e}function pt(i){if(i.length%2!==0)throw new Error(`Cannot convert ${i} to bytesArray`);const e=new Uint8Array(i.length/2);for(let n=0;n<i.length;n+=2)e[n/2]=parseInt(i.slice(n,n+2),16);return e}class Ht{constructor(e){this.nonceLength=24,this.keyPair=e?this.createKeypairFromString(e):this.createKeypair(),this.sessionId=Ot(this.keyPair.publicKey)}createKeypair(){return ht.box.keyPair()}createKeypairFromString(e){return{publicKey:pt(e.publicKey),secretKey:pt(e.secretKey)}}createNonce(){return ht.randomBytes(this.nonceLength)}encrypt(e,n){const f=new TextEncoder().encode(e),c=this.createNonce(),u=ht.box(f,c,n,this.keyPair.secretKey);return Yr(c,u)}decrypt(e,n){const[f,c]=zr(e,this.nonceLength),u=ht.box.open(c,f,n,this.keyPair.secretKey);if(!u)throw new Error(`Decryption error: 
 message: ${e.toString()} 
 sender pubkey: ${n.toString()} 
 keypair pubkey: ${this.keyPair.publicKey.toString()} 
 keypair secretkey: ${this.keyPair.secretKey.toString()}`);return new TextDecoder().decode(u)}stringifyKeypair(){return{publicKey:Ot(this.keyPair.publicKey),secretKey:Ot(this.keyPair.secretKey)}}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Gr(i,e){var n={};for(var f in i)Object.prototype.hasOwnProperty.call(i,f)&&e.indexOf(f)<0&&(n[f]=i[f]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,f=Object.getOwnPropertySymbols(i);c<f.length;c++)e.indexOf(f[c])<0&&Object.prototype.propertyIsEnumerable.call(i,f[c])&&(n[f[c]]=i[f[c]]);return n}function R(i,e,n,f){function c(u){return u instanceof n?u:new n(function(g){g(u)})}return new(n||(n=Promise))(function(u,g){function p(O){try{A(f.next(O))}catch(Y){g(Y)}}function L(O){try{A(f.throw(O))}catch(Y){g(Y)}}function A(O){O.done?u(O.value):c(O.value).then(p,L)}A((f=f.apply(i,[])).next())})}class k extends Error{constructor(e,n){super(e,n),this.message=`${k.prefix} ${this.constructor.name}${this.info?": "+this.info:""}${e?`
`+e:""}`,Object.setPrototypeOf(this,k.prototype)}get info(){return""}}k.prefix="[TON_CONNECT_SDK_ERROR]";class Zt extends k{get info(){return"Passed DappMetadata is in incorrect format."}constructor(...e){super(...e),Object.setPrototypeOf(this,Zt.prototype)}}class wt extends k{get info(){return"Passed `tonconnect-manifest.json` contains errors. Check format of your manifest. See more https://github.com/ton-connect/docs/blob/main/requests-responses.md#app-manifest"}constructor(...e){super(...e),Object.setPrototypeOf(this,wt.prototype)}}class mt extends k{get info(){return"Manifest not found. Make sure you added `tonconnect-manifest.json` to the root of your app or passed correct manifestUrl. See more https://github.com/ton-connect/docs/blob/main/requests-responses.md#app-manifest"}constructor(...e){super(...e),Object.setPrototypeOf(this,mt.prototype)}}class Xt extends k{get info(){return"Wallet connection called but wallet already connected. To avoid the error, disconnect the wallet before doing a new connection."}constructor(...e){super(...e),Object.setPrototypeOf(this,Xt.prototype)}}class yt extends k{get info(){return"Send transaction or other protocol methods called while wallet is not connected."}constructor(...e){super(...e),Object.setPrototypeOf(this,yt.prototype)}}function Hr(i){return"jsBridgeKey"in i}class _t extends k{get info(){return"User rejects the action in the wallet."}constructor(...e){super(...e),Object.setPrototypeOf(this,_t.prototype)}}class St extends k{get info(){return"Request to the wallet contains errors."}constructor(...e){super(...e),Object.setPrototypeOf(this,St.prototype)}}class Et extends k{get info(){return"App tries to send rpc request to the injected wallet while not connected."}constructor(...e){super(...e),Object.setPrototypeOf(this,Et.prototype)}}class Qt extends k{get info(){return"There is an attempt to connect to the injected wallet while it is not exists in the webpage."}constructor(...e){super(...e),Object.setPrototypeOf(this,Qt.prototype)}}class Vt extends k{get info(){return"An error occurred while fetching the wallets list."}constructor(...e){super(...e),Object.setPrototypeOf(this,Vt.prototype)}}class Ie extends k{constructor(...e){super(...e),Object.setPrototypeOf(this,Ie.prototype)}}const Cn={[We.UNKNOWN_ERROR]:Ie,[We.USER_REJECTS_ERROR]:_t,[We.BAD_REQUEST_ERROR]:St,[We.UNKNOWN_APP_ERROR]:Et,[We.MANIFEST_NOT_FOUND_ERROR]:mt,[We.MANIFEST_CONTENT_ERROR]:wt};class Jr{parseError(e){let n=Ie;return e.code in Cn&&(n=Cn[e.code]||Ie),new n(e.message)}}const Zr=new Jr;class Xr{isError(e){return"error"in e}}const An={[Fe.UNKNOWN_ERROR]:Ie,[Fe.USER_REJECTS_ERROR]:_t,[Fe.BAD_REQUEST_ERROR]:St,[Fe.UNKNOWN_APP_ERROR]:Et};class Qr extends Xr{convertToRpcRequest(e){return{method:"sendTransaction",params:[JSON.stringify(e)]}}parseAndThrowError(e){let n=Ie;throw e.error.code in An&&(n=An[e.error.code]||Ie),new n(e.error.message)}convertFromRpcResponse(e){return{boc:e.result}}}const gt=new Qr;class Vr{constructor(e,n){this.storage=e,this.storeKey="ton-connect-storage_http-bridge-gateway::"+n}storeLastEventId(e){return R(this,void 0,void 0,function*(){return this.storage.setItem(this.storeKey,e)})}removeLastEventId(){return R(this,void 0,void 0,function*(){return this.storage.removeItem(this.storeKey)})}getLastEventId(){return R(this,void 0,void 0,function*(){const e=yield this.storage.getItem(this.storeKey);return e||null})}}function ei(i){return i.slice(-1)==="/"?i.slice(0,-1):i}function Dn(i,e){return ei(i)+"/"+e}function ti(i){if(!i)return!1;const e=new URL(i);return e.protocol==="tg:"||e.hostname==="t.me"}function ni(i){return i.replaceAll(".","%2E").replaceAll("-","%2D").replaceAll("_","%5F").replaceAll("&","-").replaceAll("=","__").replaceAll("%","--")}function On(i,e){return R(this,void 0,void 0,function*(){return new Promise((n,f)=>{var c,u;if(!((c=void 0)===null||c===void 0)&&c.aborted){f(new k("Delay aborted"));return}const g=setTimeout(()=>n(),i);(u=void 0)===null||u===void 0||u.addEventListener("abort",()=>{clearTimeout(g),f(new k("Delay aborted"))})})})}function Re(i){const e=new AbortController;return i!=null&&i.aborted?e.abort():i==null||i.addEventListener("abort",()=>e.abort(),{once:!0}),e}function Ve(i,e){var n,f;return R(this,void 0,void 0,function*(){const c=(n=e==null?void 0:e.attempts)!==null&&n!==void 0?n:10,u=(f=e==null?void 0:e.delayMs)!==null&&f!==void 0?f:200,g=Re(e==null?void 0:e.signal);if(typeof i!="function")throw new k(`Expected a function, got ${typeof i}`);let p=0,L;for(;p<c;){if(g.signal.aborted)throw new k(`Aborted after attempts ${p}`);try{return yield i({signal:g.signal})}catch(A){L=A,p++,p<c&&(yield On(u))}}throw L})}function ue(...i){try{console.debug("[TON_CONNECT_SDK]",...i)}catch{}}function Le(...i){try{console.error("[TON_CONNECT_SDK]",...i)}catch{}}function ri(...i){try{console.warn("[TON_CONNECT_SDK]",...i)}catch{}}function ii(i,e){let n=null,f=null,c=null,u=null,g=null;const p=(Y,...se)=>R(this,void 0,void 0,function*(){if(u=Y??null,g==null||g.abort(),g=Re(Y),g.signal.aborted)throw new k("Resource creation was aborted");f=se??null;const ye=i(g.signal,...se);c=ye;const he=yield ye;if(c!==ye&&he!==n)throw yield e(he),new k("Resource creation was aborted by a new resource creation");return n=he,n});return{create:p,current:()=>n??null,dispose:()=>R(this,void 0,void 0,function*(){try{const Y=n;n=null;const se=c;c=null;try{g==null||g.abort()}catch{}yield Promise.allSettled([Y?e(Y):Promise.resolve(),se?e(yield se):Promise.resolve()])}catch{}}),recreate:Y=>R(this,void 0,void 0,function*(){const se=n,ye=c,he=f,Ae=u;if(yield On(Y),se===n&&ye===c&&he===f&&Ae===u)return yield p(u,...he??[]);throw new k("Resource recreation was aborted by a new resource creation")})}}function oi(i,e){const n=e==null?void 0:e.timeout,f=e==null?void 0:e.signal,c=Re(f);return new Promise((u,g)=>R(this,void 0,void 0,function*(){if(c.signal.aborted){g(new k("Operation aborted"));return}let p;typeof n<"u"&&(p=setTimeout(()=>{c.abort(),g(new k(`Timeout after ${n}ms`))},n)),c.signal.addEventListener("abort",()=>{clearTimeout(p),g(new k("Operation aborted"))},{once:!0});const L={timeout:n,abort:c.signal};yield i((...A)=>{clearTimeout(p),u(...A)},()=>{clearTimeout(p),g()},L)}))}class Ft{constructor(e,n,f,c,u){this.bridgeUrl=n,this.sessionId=f,this.listener=c,this.errorsListener=u,this.ssePath="events",this.postPath="message",this.heartbeatMessage="heartbeat",this.defaultTtl=300,this.defaultReconnectDelay=2e3,this.defaultResendDelay=5e3,this.eventSource=ii((g,p)=>R(this,void 0,void 0,function*(){const L={bridgeUrl:this.bridgeUrl,ssePath:this.ssePath,sessionId:this.sessionId,bridgeGatewayStorage:this.bridgeGatewayStorage,errorHandler:this.errorsHandler.bind(this),messageHandler:this.messagesHandler.bind(this),signal:g,openingDeadlineMS:p};return yield si(L)}),g=>R(this,void 0,void 0,function*(){g.close()})),this.bridgeGatewayStorage=new Vr(e,n)}get isReady(){const e=this.eventSource.current();return(e==null?void 0:e.readyState)===EventSource.OPEN}get isClosed(){const e=this.eventSource.current();return(e==null?void 0:e.readyState)!==EventSource.OPEN}get isConnecting(){const e=this.eventSource.current();return(e==null?void 0:e.readyState)===EventSource.CONNECTING}registerSession(e){return R(this,void 0,void 0,function*(){yield this.eventSource.create(e==null?void 0:e.signal,e==null?void 0:e.openingDeadlineMS)})}send(e,n,f,c){var u;return R(this,void 0,void 0,function*(){const g={};typeof c=="number"?g.ttl=c:(g.ttl=c==null?void 0:c.ttl,g.signal=c==null?void 0:c.signal,g.attempts=c==null?void 0:c.attempts);const p=new URL(Dn(this.bridgeUrl,this.postPath));p.searchParams.append("client_id",this.sessionId),p.searchParams.append("to",n),p.searchParams.append("ttl",((g==null?void 0:g.ttl)||this.defaultTtl).toString()),p.searchParams.append("topic",f);const L=$n.encode(e);yield Ve(A=>R(this,void 0,void 0,function*(){const O=yield this.post(p,L,A.signal);if(!O.ok)throw new k(`Bridge send failed, status ${O.status}`)}),{attempts:(u=g==null?void 0:g.attempts)!==null&&u!==void 0?u:Number.MAX_SAFE_INTEGER,delayMs:this.defaultResendDelay,signal:g==null?void 0:g.signal})})}pause(){this.eventSource.dispose().catch(e=>Le(`Bridge pause failed, ${e}`))}unPause(){return R(this,void 0,void 0,function*(){yield this.eventSource.recreate(0)})}close(){return R(this,void 0,void 0,function*(){yield this.eventSource.dispose().catch(e=>Le(`Bridge close failed, ${e}`))})}setListener(e){this.listener=e}setErrorsListener(e){this.errorsListener=e}post(e,n,f){return R(this,void 0,void 0,function*(){const c=yield fetch(e,{method:"post",body:n,signal:f});if(!c.ok)throw new k(`Bridge send failed, status ${c.status}`);return c})}errorsHandler(e,n){return R(this,void 0,void 0,function*(){if(this.isConnecting)throw e.close(),new k("Bridge error, failed to connect");if(this.isReady){try{this.errorsListener(n)}catch{}return}if(this.isClosed)return e.close(),ue(`Bridge reconnecting, ${this.defaultReconnectDelay}ms delay`),yield this.eventSource.recreate(this.defaultReconnectDelay);throw new k("Bridge error, unknown state")})}messagesHandler(e){return R(this,void 0,void 0,function*(){if(e.data===this.heartbeatMessage||(yield this.bridgeGatewayStorage.storeLastEventId(e.lastEventId),this.isClosed))return;let n;try{n=JSON.parse(e.data)}catch(f){throw new k(`Bridge message parse failed, message ${f.data}`)}this.listener(n)})}}function si(i){return R(this,void 0,void 0,function*(){return yield oi((e,n,f)=>R(this,void 0,void 0,function*(){var c;const g=Re(f.signal).signal;if(g.aborted){n(new k("Bridge connection aborted"));return}const p=new URL(Dn(i.bridgeUrl,i.ssePath));p.searchParams.append("client_id",i.sessionId);const L=yield i.bridgeGatewayStorage.getLastEventId();if(L&&p.searchParams.append("last_event_id",L),g.aborted){n(new k("Bridge connection aborted"));return}const A=new EventSource(p.toString());A.onerror=O=>R(this,void 0,void 0,function*(){if(g.aborted){A.close(),n(new k("Bridge connection aborted"));return}try{const Y=yield i.errorHandler(A,O);Y!==A&&A.close(),Y&&Y!==A&&e(Y)}catch(Y){A.close(),n(Y)}}),A.onopen=()=>{if(g.aborted){A.close(),n(new k("Bridge connection aborted"));return}e(A)},A.onmessage=O=>{if(g.aborted){A.close(),n(new k("Bridge connection aborted"));return}i.messageHandler(O)},(c=i.signal)===null||c===void 0||c.addEventListener("abort",()=>{A.close(),n(new k("Bridge connection aborted"))})}),{timeout:i.openingDeadlineMS,signal:i.signal})})}function et(i){return!("connectEvent"in i)}class nt{constructor(e){this.storage=e,this.storeKey="ton-connect-storage_bridge-connection"}storeConnection(e){return R(this,void 0,void 0,function*(){if(e.type==="injected")return this.storage.setItem(this.storeKey,JSON.stringify(e));if(!et(e)){const f={sessionKeyPair:e.session.sessionCrypto.stringifyKeypair(),walletPublicKey:e.session.walletPublicKey,bridgeUrl:e.session.bridgeUrl},c={type:"http",connectEvent:e.connectEvent,session:f,lastWalletEventId:e.lastWalletEventId,nextRpcRequestId:e.nextRpcRequestId};return this.storage.setItem(this.storeKey,JSON.stringify(c))}const n={type:"http",connectionSource:e.connectionSource,sessionCrypto:e.sessionCrypto.stringifyKeypair()};return this.storage.setItem(this.storeKey,JSON.stringify(n))})}removeConnection(){return R(this,void 0,void 0,function*(){return this.storage.removeItem(this.storeKey)})}getConnection(){return R(this,void 0,void 0,function*(){const e=yield this.storage.getItem(this.storeKey);if(!e)return null;const n=JSON.parse(e);if(n.type==="injected")return n;if("connectEvent"in n){const f=new Ht(n.session.sessionKeyPair);return{type:"http",connectEvent:n.connectEvent,lastWalletEventId:n.lastWalletEventId,nextRpcRequestId:n.nextRpcRequestId,session:{sessionCrypto:f,bridgeUrl:n.session.bridgeUrl,walletPublicKey:n.session.walletPublicKey}}}return{type:"http",sessionCrypto:new Ht(n.sessionCrypto),connectionSource:n.connectionSource}})}getHttpConnection(){return R(this,void 0,void 0,function*(){const e=yield this.getConnection();if(!e)throw new k("Trying to read HTTP connection source while nothing is stored");if(e.type==="injected")throw new k("Trying to read HTTP connection source while injected connection is stored");return e})}getHttpPendingConnection(){return R(this,void 0,void 0,function*(){const e=yield this.getConnection();if(!e)throw new k("Trying to read HTTP connection source while nothing is stored");if(e.type==="injected")throw new k("Trying to read HTTP connection source while injected connection is stored");if(!et(e))throw new k("Trying to read HTTP-pending connection while http connection is stored");return e})}getInjectedConnection(){return R(this,void 0,void 0,function*(){const e=yield this.getConnection();if(!e)throw new k("Trying to read Injected bridge connection source while nothing is stored");if((e==null?void 0:e.type)==="http")throw new k("Trying to read Injected bridge connection source while HTTP connection is stored");return e})}storedConnectionType(){return R(this,void 0,void 0,function*(){const e=yield this.storage.getItem(this.storeKey);return e?JSON.parse(e).type:null})}storeLastWalletEventId(e){return R(this,void 0,void 0,function*(){const n=yield this.getConnection();if(n&&n.type==="http"&&!et(n))return n.lastWalletEventId=e,this.storeConnection(n)})}getLastWalletEventId(){return R(this,void 0,void 0,function*(){const e=yield this.getConnection();if(e&&"lastWalletEventId"in e)return e.lastWalletEventId})}increaseNextRpcRequestId(){return R(this,void 0,void 0,function*(){const e=yield this.getConnection();if(e&&"nextRpcRequestId"in e){const n=e.nextRpcRequestId||0;return e.nextRpcRequestId=n+1,this.storeConnection(e)}})}getNextRpcRequestId(){return R(this,void 0,void 0,function*(){const e=yield this.getConnection();return e&&"nextRpcRequestId"in e&&e.nextRpcRequestId||0})}}const Fn=2;class rt{constructor(e,n){this.storage=e,this.walletConnectionSource=n,this.type="http",this.standardUniversalLink="tc://",this.pendingRequests=new Map,this.session=null,this.gateway=null,this.pendingGateways=[],this.listeners=[],this.defaultOpeningDeadlineMS=12e3,this.defaultRetryTimeoutMS=2e3,this.connectionStorage=new nt(e)}static fromStorage(e){return R(this,void 0,void 0,function*(){const f=yield new nt(e).getHttpConnection();return et(f)?new rt(e,f.connectionSource):new rt(e,{bridgeUrl:f.session.bridgeUrl})})}connect(e,n){var f;const c=Re(n==null?void 0:n.signal);(f=this.abortController)===null||f===void 0||f.abort(),this.abortController=c,this.closeGateways();const u=new Ht;this.session={sessionCrypto:u,bridgeUrl:"bridgeUrl"in this.walletConnectionSource?this.walletConnectionSource.bridgeUrl:""},this.connectionStorage.storeConnection({type:"http",connectionSource:this.walletConnectionSource,sessionCrypto:u}).then(()=>R(this,void 0,void 0,function*(){c.signal.aborted||(yield Ve(p=>{var L;return this.openGateways(u,{openingDeadlineMS:(L=n==null?void 0:n.openingDeadlineMS)!==null&&L!==void 0?L:this.defaultOpeningDeadlineMS,signal:p==null?void 0:p.signal})},{attempts:Number.MAX_SAFE_INTEGER,delayMs:this.defaultRetryTimeoutMS,signal:c.signal}))}));const g="universalLink"in this.walletConnectionSource&&this.walletConnectionSource.universalLink?this.walletConnectionSource.universalLink:this.standardUniversalLink;return this.generateUniversalLink(g,e)}restoreConnection(e){var n,f;return R(this,void 0,void 0,function*(){const c=Re(e==null?void 0:e.signal);if((n=this.abortController)===null||n===void 0||n.abort(),this.abortController=c,c.signal.aborted)return;this.closeGateways();const u=yield this.connectionStorage.getHttpConnection();if(!u||c.signal.aborted)return;const g=(f=e==null?void 0:e.openingDeadlineMS)!==null&&f!==void 0?f:this.defaultOpeningDeadlineMS;if(et(u))return this.session={sessionCrypto:u.sessionCrypto,bridgeUrl:"bridgeUrl"in this.walletConnectionSource?this.walletConnectionSource.bridgeUrl:""},yield this.openGateways(u.sessionCrypto,{openingDeadlineMS:g,signal:c==null?void 0:c.signal});if(Array.isArray(this.walletConnectionSource))throw new k("Internal error. Connection source is array while WalletConnectionSourceHTTP was expected.");if(this.session=u.session,this.gateway&&(ue("Gateway is already opened, closing previous gateway"),yield this.gateway.close()),this.gateway=new Ft(this.storage,this.walletConnectionSource.bridgeUrl,u.session.sessionCrypto.sessionId,this.gatewayListener.bind(this),this.gatewayErrorsListener.bind(this)),!c.signal.aborted){this.listeners.forEach(p=>p(u.connectEvent));try{yield Ve(p=>this.gateway.registerSession({openingDeadlineMS:g,signal:p.signal}),{attempts:Number.MAX_SAFE_INTEGER,delayMs:this.defaultRetryTimeoutMS,signal:c.signal})}catch{yield this.disconnect({signal:c.signal});return}}})}sendRequest(e,n){const f={};return typeof n=="function"?f.onRequestSent=n:(f.onRequestSent=n==null?void 0:n.onRequestSent,f.signal=n==null?void 0:n.signal,f.attempts=n==null?void 0:n.attempts),new Promise((c,u)=>R(this,void 0,void 0,function*(){var g;if(!this.gateway||!this.session||!("walletPublicKey"in this.session))throw new k("Trying to send bridge request without session");const p=(yield this.connectionStorage.getNextRpcRequestId()).toString();yield this.connectionStorage.increaseNextRpcRequestId(),ue("Send http-bridge request:",Object.assign(Object.assign({},e),{id:p}));const L=this.session.sessionCrypto.encrypt(JSON.stringify(Object.assign(Object.assign({},e),{id:p})),pt(this.session.walletPublicKey));try{yield this.gateway.send(L,this.session.walletPublicKey,e.method,{attempts:f==null?void 0:f.attempts,signal:f==null?void 0:f.signal}),(g=f==null?void 0:f.onRequestSent)===null||g===void 0||g.call(f),this.pendingRequests.set(p.toString(),c)}catch(A){u(A)}}))}closeConnection(){this.closeGateways(),this.listeners=[],this.session=null,this.gateway=null}disconnect(e){return R(this,void 0,void 0,function*(){return new Promise(n=>R(this,void 0,void 0,function*(){let f=!1,c=null;const u=()=>{f||(f=!0,this.removeBridgeAndSession().then(n))};try{this.closeGateways();const g=Re(e==null?void 0:e.signal);c=setTimeout(()=>{g.abort()},this.defaultOpeningDeadlineMS),yield this.sendRequest({method:"disconnect",params:[]},{onRequestSent:u,signal:g.signal,attempts:1})}catch(g){ue("Disconnect error:",g),f||this.removeBridgeAndSession().then(n)}finally{c&&clearTimeout(c),u()}}))})}listen(e){return this.listeners.push(e),()=>this.listeners=this.listeners.filter(n=>n!==e)}pause(){var e;(e=this.gateway)===null||e===void 0||e.pause(),this.pendingGateways.forEach(n=>n.pause())}unPause(){return R(this,void 0,void 0,function*(){const e=this.pendingGateways.map(n=>n.unPause());this.gateway&&e.push(this.gateway.unPause()),yield Promise.all(e)})}pendingGatewaysListener(e,n,f){return R(this,void 0,void 0,function*(){if(!this.pendingGateways.includes(e)){yield e.close();return}return this.closeGateways({except:e}),this.gateway&&(ue("Gateway is already opened, closing previous gateway"),yield this.gateway.close()),this.session.bridgeUrl=n,this.gateway=e,this.gateway.setErrorsListener(this.gatewayErrorsListener.bind(this)),this.gateway.setListener(this.gatewayListener.bind(this)),this.gatewayListener(f)})}gatewayListener(e){return R(this,void 0,void 0,function*(){const n=JSON.parse(this.session.sessionCrypto.decrypt($n.decode(e.message).toUint8Array(),pt(e.from)));if(ue("Wallet message received:",n),!("event"in n)){const c=n.id.toString(),u=this.pendingRequests.get(c);if(!u){ue(`Response id ${c} doesn't match any request's id`);return}u(n),this.pendingRequests.delete(c);return}if(n.id!==void 0){const c=yield this.connectionStorage.getLastWalletEventId();if(c!==void 0&&n.id<=c){Le(`Received event id (=${n.id}) must be greater than stored last wallet event id (=${c}) `);return}n.event!=="connect"&&(yield this.connectionStorage.storeLastWalletEventId(n.id))}const f=this.listeners;n.event==="connect"&&(yield this.updateSession(n,e.from)),n.event==="disconnect"&&(ue("Removing bridge and session: received disconnect event"),yield this.removeBridgeAndSession()),f.forEach(c=>c(n))})}gatewayErrorsListener(e){return R(this,void 0,void 0,function*(){throw new k(`Bridge error ${JSON.stringify(e)}`)})}updateSession(e,n){return R(this,void 0,void 0,function*(){this.session=Object.assign(Object.assign({},this.session),{walletPublicKey:n});const f=e.payload.items.find(u=>u.name==="ton_addr"),c=Object.assign(Object.assign({},e),{payload:Object.assign(Object.assign({},e.payload),{items:[f]})});yield this.connectionStorage.storeConnection({type:"http",session:this.session,lastWalletEventId:e.id,connectEvent:c,nextRpcRequestId:0})})}removeBridgeAndSession(){return R(this,void 0,void 0,function*(){this.closeConnection(),yield this.connectionStorage.removeConnection()})}generateUniversalLink(e,n){return ti(e)?this.generateTGUniversalLink(e,n):this.generateRegularUniversalLink(e,n)}generateRegularUniversalLink(e,n){const f=new URL(e);return f.searchParams.append("v",Fn.toString()),f.searchParams.append("id",this.session.sessionCrypto.sessionId),f.searchParams.append("r",JSON.stringify(n)),f.toString()}generateTGUniversalLink(e,n){const c=this.generateRegularUniversalLink("about:blank",n).split("?")[1],u="tonconnect-"+ni(c),g=this.convertToDirectLink(e),p=new URL(g);return p.searchParams.append("startapp",u),p.toString()}convertToDirectLink(e){const n=new URL(e);return n.searchParams.has("attach")&&(n.searchParams.delete("attach"),n.pathname+="/start"),n.toString()}openGateways(e,n){return R(this,void 0,void 0,function*(){if(Array.isArray(this.walletConnectionSource)){this.pendingGateways.map(f=>f.close().catch()),this.pendingGateways=this.walletConnectionSource.map(f=>{const c=new Ft(this.storage,f.bridgeUrl,e.sessionId,()=>{},()=>{});return c.setListener(u=>this.pendingGatewaysListener(c,f.bridgeUrl,u)),c}),yield Promise.allSettled(this.pendingGateways.map(f=>Ve(c=>{var u;return this.pendingGateways.some(g=>g===f)?f.registerSession({openingDeadlineMS:(u=n==null?void 0:n.openingDeadlineMS)!==null&&u!==void 0?u:this.defaultOpeningDeadlineMS,signal:c.signal}):f.close()},{attempts:Number.MAX_SAFE_INTEGER,delayMs:this.defaultRetryTimeoutMS,signal:n==null?void 0:n.signal})));return}else return this.gateway&&(ue("Gateway is already opened, closing previous gateway"),yield this.gateway.close()),this.gateway=new Ft(this.storage,this.walletConnectionSource.bridgeUrl,e.sessionId,this.gatewayListener.bind(this),this.gatewayErrorsListener.bind(this)),yield this.gateway.registerSession({openingDeadlineMS:n==null?void 0:n.openingDeadlineMS,signal:n==null?void 0:n.signal})})}closeGateways(e){var n;(n=this.gateway)===null||n===void 0||n.close(),this.pendingGateways.filter(f=>f!==(e==null?void 0:e.except)).forEach(f=>f.close()),this.pendingGateways=[]}}function Pn(i,e){return Yn(i,[e])}function Yn(i,e){return!i||typeof i!="object"?!1:e.every(n=>n in i)}function ai(i){try{return!Pn(i,"tonconnect")||!Pn(i.tonconnect,"walletInfo")?!1:Yn(i.tonconnect.walletInfo,["name","app_name","image","about_url","platforms"])}catch{return!1}}class Ye{constructor(){this.storage={}}static getInstance(){return Ye.instance||(Ye.instance=new Ye),Ye.instance}get length(){return Object.keys(this.storage).length}clear(){this.storage={}}getItem(e){var n;return(n=this.storage[e])!==null&&n!==void 0?n:null}key(e){var n;const f=Object.keys(this.storage);return e<0||e>=f.length?null:(n=f[e])!==null&&n!==void 0?n:null}removeItem(e){delete this.storage[e]}setItem(e,n){this.storage[e]=n}}function Ut(){if(!(typeof window>"u"))return window}function fi(){const i=Ut();if(!i)return[];try{return Object.keys(i)}catch{return[]}}function ci(){if(!(typeof document>"u"))return document}function li(){var i;const e=(i=Ut())===null||i===void 0?void 0:i.location.origin;return e?e+"/tonconnect-manifest.json":""}function di(){if(ui())return localStorage;if(hi())throw new k("`localStorage` is unavailable, but it is required for TonConnect. For more details, see https://github.com/ton-connect/sdk/tree/main/packages/sdk#init-connector");return Ye.getInstance()}function ui(){try{return typeof localStorage<"u"}catch{return!1}}function hi(){return typeof process<"u"&&process.versions!=null&&process.versions.node!=null}class we{constructor(e,n){this.injectedWalletKey=n,this.type="injected",this.unsubscribeCallback=null,this.listenSubscriptions=!1,this.listeners=[];const f=we.window;if(!we.isWindowContainsWallet(f,n))throw new Qt;this.connectionStorage=new nt(e),this.injectedWallet=f[n].tonconnect}static fromStorage(e){return R(this,void 0,void 0,function*(){const f=yield new nt(e).getInjectedConnection();return new we(e,f.jsBridgeKey)})}static isWalletInjected(e){return we.isWindowContainsWallet(this.window,e)}static isInsideWalletBrowser(e){return we.isWindowContainsWallet(this.window,e)?this.window[e].tonconnect.isWalletBrowser:!1}static getCurrentlyInjectedWallets(){return this.window?fi().filter(([f,c])=>ai(c)).map(([f,c])=>({name:c.tonconnect.walletInfo.name,appName:c.tonconnect.walletInfo.app_name,aboutUrl:c.tonconnect.walletInfo.about_url,imageUrl:c.tonconnect.walletInfo.image,tondns:c.tonconnect.walletInfo.tondns,jsBridgeKey:f,injected:!0,embedded:c.tonconnect.isWalletBrowser,platforms:c.tonconnect.walletInfo.platforms})):[]}static isWindowContainsWallet(e,n){return!!e&&n in e&&typeof e[n]=="object"&&"tonconnect"in e[n]}connect(e){this._connect(Fn,e)}restoreConnection(){return R(this,void 0,void 0,function*(){try{ue("Injected Provider restoring connection...");const e=yield this.injectedWallet.restoreConnection();ue("Injected Provider restoring connection response",e),e.event==="connect"?(this.makeSubscriptions(),this.listeners.forEach(n=>n(e))):yield this.connectionStorage.removeConnection()}catch(e){yield this.connectionStorage.removeConnection(),console.error(e)}})}closeConnection(){this.listenSubscriptions&&this.injectedWallet.disconnect(),this.closeAllListeners()}disconnect(){return R(this,void 0,void 0,function*(){return new Promise(e=>{const n=()=>{this.closeAllListeners(),this.connectionStorage.removeConnection().then(e)};try{this.injectedWallet.disconnect(),n()}catch(f){ue(f),this.sendRequest({method:"disconnect",params:[]},n)}})})}closeAllListeners(){var e;this.listenSubscriptions=!1,this.listeners=[],(e=this.unsubscribeCallback)===null||e===void 0||e.call(this)}listen(e){return this.listeners.push(e),()=>this.listeners=this.listeners.filter(n=>n!==e)}sendRequest(e,n){var f;return R(this,void 0,void 0,function*(){const c={};typeof n=="function"?c.onRequestSent=n:(c.onRequestSent=n==null?void 0:n.onRequestSent,c.signal=n==null?void 0:n.signal);const u=(yield this.connectionStorage.getNextRpcRequestId()).toString();yield this.connectionStorage.increaseNextRpcRequestId(),ue("Send injected-bridge request:",Object.assign(Object.assign({},e),{id:u}));const g=this.injectedWallet.send(Object.assign(Object.assign({},e),{id:u}));return g.then(p=>ue("Wallet message received:",p)),(f=c==null?void 0:c.onRequestSent)===null||f===void 0||f.call(c),g})}_connect(e,n){return R(this,void 0,void 0,function*(){try{ue(`Injected Provider connect request: protocolVersion: ${e}, message:`,n);const f=yield this.injectedWallet.connect(e,n);ue("Injected Provider connect response:",f),f.event==="connect"&&(yield this.updateSession(),this.makeSubscriptions()),this.listeners.forEach(c=>c(f))}catch(f){ue("Injected Provider connect error:",f);const c={event:"connect_error",payload:{code:0,message:f==null?void 0:f.toString()}};this.listeners.forEach(u=>u(c))}})}makeSubscriptions(){this.listenSubscriptions=!0,this.unsubscribeCallback=this.injectedWallet.listen(e=>{ue("Wallet message received:",e),this.listenSubscriptions&&this.listeners.forEach(n=>n(e)),e.event==="disconnect"&&this.disconnect()})}updateSession(){return this.connectionStorage.storeConnection({type:"injected",jsBridgeKey:this.injectedWalletKey,nextRpcRequestId:0})}}we.window=Ut();class gi{constructor(){this.localStorage=di()}getItem(e){return R(this,void 0,void 0,function*(){return this.localStorage.getItem(e)})}removeItem(e){return R(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}setItem(e,n){return R(this,void 0,void 0,function*(){this.localStorage.setItem(e,n)})}}function xi(i){return pi(i)&&i.injected}function vi(i){return xi(i)&&i.embedded}function pi(i){return"jsBridgeKey"in i}const yi=[{app_name:"telegram-wallet",name:"Wallet",image:"https://wallet.tg/images/logo-288.png",about_url:"https://wallet.tg/",universal_url:"https://t.me/wallet?attach=wallet",bridge:[{type:"sse",url:"https://bridge.ton.space/bridge"}],platforms:["ios","android","macos","windows","linux"]},{app_name:"tonkeeper",name:"Tonkeeper",image:"https://tonkeeper.com/assets/tonconnect-icon.png",tondns:"tonkeeper.ton",about_url:"https://tonkeeper.com",universal_url:"https://app.tonkeeper.com/ton-connect",deepLink:"tonkeeper-tc://",bridge:[{type:"sse",url:"https://bridge.tonapi.io/bridge"},{type:"js",key:"tonkeeper"}],platforms:["ios","android","chrome","firefox","macos"]},{app_name:"mytonwallet",name:"MyTonWallet",image:"https://static.mytonwallet.io/icon-256.png",about_url:"https://mytonwallet.io",universal_url:"https://connect.mytonwallet.org",bridge:[{type:"js",key:"mytonwallet"},{type:"sse",url:"https://tonconnectbridge.mytonwallet.org/bridge/"}],platforms:["chrome","windows","macos","linux","ios","android","firefox"]},{app_name:"openmask",name:"OpenMask",image:"https://raw.githubusercontent.com/OpenProduct/openmask-extension/main/public/openmask-logo-288.png",about_url:"https://www.openmask.app/",bridge:[{type:"js",key:"openmask"}],platforms:["chrome"]},{app_name:"tonhub",name:"Tonhub",image:"https://tonhub.com/tonconnect_logo.png",about_url:"https://tonhub.com",universal_url:"https://tonhub.com/ton-connect",bridge:[{type:"js",key:"tonhub"},{type:"sse",url:"https://connect.tonhubapi.com/tonconnect"}],platforms:["ios","android"]},{app_name:"dewallet",name:"DeWallet",image:"https://raw.githubusercontent.com/delab-team/manifests-images/main/WalletAvatar.png",about_url:"https://delabwallet.com",universal_url:"https://t.me/dewallet?attach=wallet",bridge:[{type:"sse",url:"https://sse-bridge.delab.team/bridge"}],platforms:["ios","android"]},{app_name:"xtonwallet",name:"XTONWallet",image:"https://xtonwallet.com/assets/img/icon-256-back.png",about_url:"https://xtonwallet.com",bridge:[{type:"js",key:"xtonwallet"}],platforms:["chrome","firefox"]},{app_name:"tonwallet",name:"TON Wallet",image:"https://wallet.ton.org/assets/ui/qr-logo.png",about_url:"https://chrome.google.com/webstore/detail/ton-wallet/nphplpgoakhhjchkkhmiggakijnkhfnd",bridge:[{type:"js",key:"tonwallet"}],platforms:["chrome"]},{app_name:"bitgetTonWallet",name:"Bitget Wallet",image:"https://raw.githubusercontent.com/bitkeepwallet/download/main/logo/png/bitget_wallet_logo_0_gas_fee.png",about_url:"https://web3.bitget.com",deepLink:"bitkeep://",bridge:[{type:"js",key:"bitgetTonWallet"},{type:"sse",url:"https://bridge.tonapi.io/bridge"}],platforms:["ios","android","chrome"],universal_url:"https://bkcode.vip/ton-connect"},{app_name:"safepalwallet",name:"SafePal",image:"https://s.pvcliping.com/web/public_image/SafePal_x288.png",tondns:"",about_url:"https://www.safepal.com",universal_url:"https://link.safepal.io/ton-connect",deepLink:"safepal-tc://",bridge:[{type:"sse",url:"https://ton-bridge.safepal.com/tonbridge/v1/bridge"},{type:"js",key:"safepalwallet"}],platforms:["ios","android","chrome","firefox"]},{app_name:"okxTonWallet",name:"OKX Wallet",image:"https://static.okx.com/cdn/assets/imgs/247/58E63FEA47A2B7D7.png",about_url:"https://www.okx.com/web3",universal_url:"https://www.okx.com/download?appendQuery=true&deeplink=okx://web3/wallet/tonconnect",bridge:[{type:"js",key:"okxTonWallet"},{type:"sse",url:"https://www.okx.com/tonbridge/discover/rpc/bridge"}],platforms:["chrome","safari","firefox","ios","android"]},{app_name:"okxTonWalletTr",name:"OKX TR Wallet",image:"https://static.okx.com/cdn/assets/imgs/247/587A8296F0BB640F.png",about_url:"https://tr.okx.com/web3",universal_url:"https://tr.okx.com/download?appendQuery=true&deeplink=okxtr://web3/wallet/tonconnect",bridge:[{type:"js",key:"okxTonWallet"},{type:"sse",url:"https://www.okx.com/tonbridge/discover/rpc/bridge"}],platforms:["chrome","safari","firefox","ios","android"]}];class Jt{constructor(e){this.walletsListCache=null,this.walletsListCacheCreationTimestamp=null,this.walletsListSource="https://raw.githubusercontent.com/ton-blockchain/wallets-list/main/wallets-v2.json",e!=null&&e.walletsListSource&&(this.walletsListSource=e.walletsListSource),e!=null&&e.cacheTTLMs&&(this.cacheTTLMs=e.cacheTTLMs)}getWallets(){return R(this,void 0,void 0,function*(){return this.cacheTTLMs&&this.walletsListCacheCreationTimestamp&&Date.now()>this.walletsListCacheCreationTimestamp+this.cacheTTLMs&&(this.walletsListCache=null),this.walletsListCache||(this.walletsListCache=this.fetchWalletsList(),this.walletsListCache.then(()=>{this.walletsListCacheCreationTimestamp=Date.now()}).catch(()=>{this.walletsListCache=null,this.walletsListCacheCreationTimestamp=null})),this.walletsListCache})}getEmbeddedWallet(){return R(this,void 0,void 0,function*(){const n=(yield this.getWallets()).filter(vi);return n.length!==1?null:n[0]})}fetchWalletsList(){return R(this,void 0,void 0,function*(){let e=[];try{if(e=yield(yield fetch(this.walletsListSource)).json(),!Array.isArray(e))throw new Vt("Wrong wallets list format, wallets list must be an array.");const c=e.filter(u=>!this.isCorrectWalletConfigDTO(u));c.length&&(Le(`Wallet(s) ${c.map(u=>u.name).join(", ")} config format is wrong. They were removed from the wallets list.`),e=e.filter(u=>this.isCorrectWalletConfigDTO(u)))}catch(f){Le(f),e=yi}let n=[];try{n=we.getCurrentlyInjectedWallets()}catch(f){Le(f)}return this.mergeWalletsLists(this.walletConfigDTOListToWalletConfigList(e),n)})}walletConfigDTOListToWalletConfigList(e){return e.map(n=>{const c={name:n.name,appName:n.app_name,imageUrl:n.image,aboutUrl:n.about_url,tondns:n.tondns,platforms:n.platforms};return n.bridge.forEach(u=>{if(u.type==="sse"&&(c.bridgeUrl=u.url,c.universalLink=n.universal_url,c.deepLink=n.deepLink),u.type==="js"){const g=u.key;c.jsBridgeKey=g,c.injected=we.isWalletInjected(g),c.embedded=we.isInsideWalletBrowser(g)}}),c})}mergeWalletsLists(e,n){return[...new Set(e.concat(n).map(c=>c.name)).values()].map(c=>{const u=e.find(p=>p.name===c),g=n.find(p=>p.name===c);return Object.assign(Object.assign({},u&&Object.assign({},u)),g&&Object.assign({},g))})}isCorrectWalletConfigDTO(e){if(!e||typeof e!="object")return!1;const n="name"in e,f="app_name"in e,c="image"in e,u="about_url"in e,g="platforms"in e;if(!n||!c||!u||!g||!f||!e.platforms||!Array.isArray(e.platforms)||!e.platforms.length||!("bridge"in e)||!Array.isArray(e.bridge)||!e.bridge.length)return!1;const p=e.bridge;if(p.some(O=>!O||typeof O!="object"||!("type"in O)))return!1;const L=p.find(O=>O.type==="sse");if(L&&(!("url"in L)||!L.url||!e.universal_url))return!1;const A=p.find(O=>O.type==="js");return!(A&&(!("key"in A)||!A.key))}}class bt extends k{get info(){return"Wallet doesn't support requested feature method."}constructor(...e){super(...e),Object.setPrototypeOf(this,bt.prototype)}}function bi(i,e){const n=i.includes("SendTransaction"),f=i.find(c=>c&&typeof c=="object"&&c.name==="SendTransaction");if(!n&&!f)throw new bt("Wallet doesn't support SendTransaction feature.");if(f&&f.maxMessages!==void 0){if(f.maxMessages<e.requiredMessagesNumber)throw new bt(`Wallet is not able to handle such SendTransaction request. Max support messages number is ${f.maxMessages}, but ${e.requiredMessagesNumber} is required.`);return}ri("Connected wallet didn't provide information about max allowed messages in the SendTransaction request. Request may be rejected by the wallet.")}function wi(){return{type:"request-version"}}function mi(i){return{type:"response-version",version:i}}function ze(i){return{ton_connect_sdk_lib:i.ton_connect_sdk_lib,ton_connect_ui_lib:i.ton_connect_ui_lib}}function Ge(i,e){var n,f,c,u,g,p,L,A;const Y=((n=e==null?void 0:e.connectItems)===null||n===void 0?void 0:n.tonProof)&&"proof"in e.connectItems.tonProof?"ton_proof":"ton_addr";return{wallet_address:(c=(f=e==null?void 0:e.account)===null||f===void 0?void 0:f.address)!==null&&c!==void 0?c:null,wallet_type:(u=e==null?void 0:e.device.appName)!==null&&u!==void 0?u:null,wallet_version:(g=e==null?void 0:e.device.appVersion)!==null&&g!==void 0?g:null,auth_type:Y,custom_data:Object.assign({chain_id:(L=(p=e==null?void 0:e.account)===null||p===void 0?void 0:p.chain)!==null&&L!==void 0?L:null,provider:(A=e==null?void 0:e.provider)!==null&&A!==void 0?A:null},ze(i))}}function _i(i){return{type:"connection-started",custom_data:ze(i)}}function Si(i,e){return Object.assign({type:"connection-completed",is_success:!0},Ge(i,e))}function Ei(i,e,n){return{type:"connection-error",is_success:!1,error_message:e,error_code:n??null,custom_data:ze(i)}}function Ui(i){return{type:"connection-restoring-started",custom_data:ze(i)}}function Ti(i,e){return Object.assign({type:"connection-restoring-completed",is_success:!0},Ge(i,e))}function Ri(i,e){return{type:"connection-restoring-error",is_success:!1,error_message:e,custom_data:ze(i)}}function en(i,e){var n,f,c,u;return{valid_until:(n=String(e.validUntil))!==null&&n!==void 0?n:null,from:(u=(f=e.from)!==null&&f!==void 0?f:(c=i==null?void 0:i.account)===null||c===void 0?void 0:c.address)!==null&&u!==void 0?u:null,messages:e.messages.map(g=>{var p,L;return{address:(p=g.address)!==null&&p!==void 0?p:null,amount:(L=g.amount)!==null&&L!==void 0?L:null}})}}function Ci(i,e,n){return Object.assign(Object.assign({type:"transaction-sent-for-signature"},Ge(i,e)),en(e,n))}function Ai(i,e,n,f){return Object.assign(Object.assign({type:"transaction-signed",is_success:!0,signed_transaction:f.boc},Ge(i,e)),en(e,n))}function Pi(i,e,n,f,c){return Object.assign(Object.assign({type:"transaction-signing-failed",is_success:!1,error_message:f,error_code:c??null},Ge(i,e)),en(e,n))}function ji(i,e,n){return Object.assign({type:"disconnection",scope:n},Ge(i,e))}class Li{constructor(){this.window=Ut()}dispatchEvent(e,n){var f;return R(this,void 0,void 0,function*(){const c=new CustomEvent(e,{detail:n});(f=this.window)===null||f===void 0||f.dispatchEvent(c)})}addEventListener(e,n,f){var c;return R(this,void 0,void 0,function*(){return(c=this.window)===null||c===void 0||c.addEventListener(e,n,f),()=>{var u;return(u=this.window)===null||u===void 0?void 0:u.removeEventListener(e,n)}})}}class Wi{constructor(e){var n;this.eventPrefix="ton-connect-",this.tonConnectUiVersion=null,this.eventDispatcher=(n=e==null?void 0:e.eventDispatcher)!==null&&n!==void 0?n:new Li,this.tonConnectSdkVersion=e.tonConnectSdkVersion,this.init().catch()}get version(){return ze({ton_connect_sdk_lib:this.tonConnectSdkVersion,ton_connect_ui_lib:this.tonConnectUiVersion})}init(){return R(this,void 0,void 0,function*(){try{yield this.setRequestVersionHandler(),this.tonConnectUiVersion=yield this.requestTonConnectUiVersion()}catch{}})}setRequestVersionHandler(){return R(this,void 0,void 0,function*(){yield this.eventDispatcher.addEventListener("ton-connect-request-version",()=>R(this,void 0,void 0,function*(){yield this.eventDispatcher.dispatchEvent("ton-connect-response-version",mi(this.tonConnectSdkVersion))}))})}requestTonConnectUiVersion(){return R(this,void 0,void 0,function*(){return new Promise((e,n)=>R(this,void 0,void 0,function*(){try{yield this.eventDispatcher.addEventListener("ton-connect-ui-response-version",f=>{e(f.detail.version)},{once:!0}),yield this.eventDispatcher.dispatchEvent("ton-connect-ui-request-version",wi())}catch(f){n(f)}}))})}dispatchUserActionEvent(e){try{this.eventDispatcher.dispatchEvent(`${this.eventPrefix}${e.type}`,e).catch()}catch{}}trackConnectionStarted(...e){try{const n=_i(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}trackConnectionCompleted(...e){try{const n=Si(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}trackConnectionError(...e){try{const n=Ei(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}trackConnectionRestoringStarted(...e){try{const n=Ui(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}trackConnectionRestoringCompleted(...e){try{const n=Ti(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}trackConnectionRestoringError(...e){try{const n=Ri(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}trackDisconnection(...e){try{const n=ji(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}trackTransactionSentForSignature(...e){try{const n=Ci(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}trackTransactionSigned(...e){try{const n=Ai(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}trackTransactionSigningFailed(...e){try{const n=Pi(this.version,...e);this.dispatchUserActionEvent(n)}catch{}}}const Mi="3.0.5";class Tt{constructor(e){if(this.walletsList=new Jt,this._wallet=null,this.provider=null,this.statusChangeSubscriptions=[],this.statusChangeErrorSubscriptions=[],this.dappSettings={manifestUrl:(e==null?void 0:e.manifestUrl)||li(),storage:(e==null?void 0:e.storage)||new gi},this.walletsList=new Jt({walletsListSource:e==null?void 0:e.walletsListSource,cacheTTLMs:e==null?void 0:e.walletsListCacheTTLMs}),this.tracker=new Wi({eventDispatcher:e==null?void 0:e.eventDispatcher,tonConnectSdkVersion:Mi}),!this.dappSettings.manifestUrl)throw new Zt("Dapp tonconnect-manifest.json must be specified if window.location.origin is undefined. See more https://github.com/ton-connect/docs/blob/main/requests-responses.md#app-manifest");this.bridgeConnectionStorage=new nt(this.dappSettings.storage),e!=null&&e.disableAutoPauseConnection||this.addWindowFocusAndBlurSubscriptions()}static getWallets(){return this.walletsList.getWallets()}get connected(){return this._wallet!==null}get account(){var e;return((e=this._wallet)===null||e===void 0?void 0:e.account)||null}get wallet(){return this._wallet}set wallet(e){this._wallet=e,this.statusChangeSubscriptions.forEach(n=>n(this._wallet))}getWallets(){return this.walletsList.getWallets()}onStatusChange(e,n){return this.statusChangeSubscriptions.push(e),n&&this.statusChangeErrorSubscriptions.push(n),()=>{this.statusChangeSubscriptions=this.statusChangeSubscriptions.filter(f=>f!==e),n&&(this.statusChangeErrorSubscriptions=this.statusChangeErrorSubscriptions.filter(f=>f!==n))}}connect(e,n){var f,c;const u={};if(typeof n=="object"&&"tonProof"in n&&(u.request=n),typeof n=="object"&&("openingDeadlineMS"in n||"signal"in n||"request"in n)&&(u.request=n==null?void 0:n.request,u.openingDeadlineMS=n==null?void 0:n.openingDeadlineMS,u.signal=n==null?void 0:n.signal),this.connected)throw new Xt;const g=Re(u==null?void 0:u.signal);if((f=this.abortController)===null||f===void 0||f.abort(),this.abortController=g,g.signal.aborted)throw new k("Connection was aborted");return(c=this.provider)===null||c===void 0||c.closeConnection(),this.provider=this.createProvider(e),g.signal.addEventListener("abort",()=>{var p;(p=this.provider)===null||p===void 0||p.closeConnection(),this.provider=null}),this.tracker.trackConnectionStarted(),this.provider.connect(this.createConnectRequest(u==null?void 0:u.request),{openingDeadlineMS:u==null?void 0:u.openingDeadlineMS,signal:g.signal})}restoreConnection(e){var n,f;return R(this,void 0,void 0,function*(){this.tracker.trackConnectionRestoringStarted();const c=Re(e==null?void 0:e.signal);if((n=this.abortController)===null||n===void 0||n.abort(),this.abortController=c,c.signal.aborted){this.tracker.trackConnectionRestoringError("Connection restoring was aborted");return}const[u,g]=yield Promise.all([this.bridgeConnectionStorage.storedConnectionType(),this.walletsList.getEmbeddedWallet()]);if(c.signal.aborted){this.tracker.trackConnectionRestoringError("Connection restoring was aborted");return}let p=null;try{switch(u){case"http":p=yield rt.fromStorage(this.dappSettings.storage);break;case"injected":p=yield we.fromStorage(this.dappSettings.storage);break;default:if(g)p=this.createProvider(g);else return}}catch{this.tracker.trackConnectionRestoringError("Provider is not restored"),yield this.bridgeConnectionStorage.removeConnection(),p==null||p.closeConnection(),p=null;return}if(c.signal.aborted){p==null||p.closeConnection(),this.tracker.trackConnectionRestoringError("Connection restoring was aborted");return}if(!p){Le("Provider is not restored"),this.tracker.trackConnectionRestoringError("Provider is not restored");return}(f=this.provider)===null||f===void 0||f.closeConnection(),this.provider=p,p.listen(this.walletEventsListener.bind(this));const L=()=>{this.tracker.trackConnectionRestoringError("Connection restoring was aborted"),p==null||p.closeConnection(),p=null};c.signal.addEventListener("abort",L);const A=Ve(Y=>R(this,void 0,void 0,function*(){yield p==null?void 0:p.restoreConnection({openingDeadlineMS:e==null?void 0:e.openingDeadlineMS,signal:Y.signal}),c.signal.removeEventListener("abort",L),this.connected?this.tracker.trackConnectionRestoringCompleted(this.wallet):this.tracker.trackConnectionRestoringError("Connection restoring failed")}),{attempts:Number.MAX_SAFE_INTEGER,delayMs:2e3,signal:e==null?void 0:e.signal}),O=new Promise(Y=>setTimeout(()=>Y(),12e3));return Promise.race([A,O])})}sendTransaction(e,n){return R(this,void 0,void 0,function*(){const f={};typeof n=="function"?f.onRequestSent=n:(f.onRequestSent=n==null?void 0:n.onRequestSent,f.signal=n==null?void 0:n.signal);const c=Re(f==null?void 0:f.signal);if(c.signal.aborted)throw new k("Transaction sending was aborted");this.checkConnection(),bi(this.wallet.device.features,{requiredMessagesNumber:e.messages.length}),this.tracker.trackTransactionSentForSignature(this.wallet,e);const{validUntil:u}=e,g=Gr(e,["validUntil"]),p=e.from||this.account.address,L=e.network||this.account.chain,A=yield this.provider.sendRequest(gt.convertToRpcRequest(Object.assign(Object.assign({},g),{valid_until:u,from:p,network:L})),{onRequestSent:f.onRequestSent,signal:c.signal});if(gt.isError(A))return this.tracker.trackTransactionSigningFailed(this.wallet,e,A.error.message,A.error.code),gt.parseAndThrowError(A);const O=gt.convertFromRpcResponse(A);return this.tracker.trackTransactionSigned(this.wallet,e,O),O})}disconnect(e){var n;return R(this,void 0,void 0,function*(){if(!this.connected)throw new yt;const f=Re(e==null?void 0:e.signal),c=this.abortController;if(this.abortController=f,f.signal.aborted)throw new k("Disconnect was aborted");this.onWalletDisconnected("dapp"),yield(n=this.provider)===null||n===void 0?void 0:n.disconnect({signal:f.signal}),c==null||c.abort()})}pauseConnection(){var e;((e=this.provider)===null||e===void 0?void 0:e.type)==="http"&&this.provider.pause()}unPauseConnection(){var e;return((e=this.provider)===null||e===void 0?void 0:e.type)!=="http"?Promise.resolve():this.provider.unPause()}addWindowFocusAndBlurSubscriptions(){const e=ci();if(e)try{e.addEventListener("visibilitychange",()=>{e.hidden?this.pauseConnection():this.unPauseConnection().catch()})}catch(n){Le("Cannot subscribe to the document.visibilitychange: ",n)}}createProvider(e){let n;return!Array.isArray(e)&&Hr(e)?n=new we(this.dappSettings.storage,e.jsBridgeKey):n=new rt(this.dappSettings.storage,e),n.listen(this.walletEventsListener.bind(this)),n}walletEventsListener(e){switch(e.event){case"connect":this.onWalletConnected(e.payload);break;case"connect_error":this.onWalletConnectError(e.payload);break;case"disconnect":this.onWalletDisconnected("wallet")}}onWalletConnected(e){const n=e.items.find(u=>u.name==="ton_addr"),f=e.items.find(u=>u.name==="ton_proof");if(!n)throw new k("ton_addr connection item was not found");const c={device:e.device,provider:this.provider.type,account:{address:n.address,chain:n.network,walletStateInit:n.walletStateInit,publicKey:n.publicKey}};f&&(c.connectItems={tonProof:f}),this.wallet=c,this.tracker.trackConnectionCompleted(c)}onWalletConnectError(e){const n=Zr.parseError(e);if(this.statusChangeErrorSubscriptions.forEach(f=>f(n)),ue(n),this.tracker.trackConnectionError(e.message,e.code),n instanceof mt||n instanceof wt)throw Le(n),n}onWalletDisconnected(e){this.tracker.trackDisconnection(this.wallet,e),this.wallet=null}checkConnection(){if(!this.connected)throw new yt}createConnectRequest(e){const n=[{name:"ton_addr"}];return e!=null&&e.tonProof&&n.push({name:"ton_proof",payload:e.tonProof}),{manifestUrl:this.dappSettings.manifestUrl,items:n}}}Tt.walletsList=new Jt;Tt.isWalletInjected=i=>we.isWalletInjected(i);Tt.isInsideWalletBrowser=i=>we.isInsideWalletBrowser(i);for(let i=0;i<=255;i++){let e=i.toString(16);e.length<2&&(e="0"+e)}const Ii={class:"flex flex-col items-center justify-center h-screen w-full bg-gradient-to-br from-pink-500 to-indigo-500 text-white"},Bi={key:0},ki={key:1},Ni={class:"text-lg mb-8"},qi={__name:"airdrop",setup(i){const e=new Tt,n=zt(null),f=async()=>{try{await e.connectWallet();const g=e.getAccounts();g.length>0&&(n.value=g[0].address)}catch(g){console.error("   :",g)}},c=or(),u=()=>{c.push("/")};return Mn(()=>{const g=e.getAccounts();g.length>0&&(n.value=g[0].address)}),(g,p)=>{const L=jr;return xt(),vt("div",Ii,[sr(L,{src:Gt(Lr)("images/airdrop.png"),alt:"AirDrop",class:"w-64 h-64 mb-4"},null,8,["src"]),p[0]||(p[0]=Qe("h1",{class:"text-4xl font-bold mb-2"},"",-1)),p[1]||(p[1]=Qe("p",{class:"text-lg mb-8"},"  ",-1)),n.value?(xt(),vt("div",ki,[Qe("p",Ni," : "+ar(n.value),1)])):(xt(),vt("div",Bi,[Qe("button",{onClick:f,class:"bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded mb-4"},"   ")])),Qe("button",{onClick:u,class:"bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded"},"  ")])}}};export{qi as default};
